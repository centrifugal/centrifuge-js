!function(e){function t(n){if(s[n])return s[n].exports;var i=s[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var s={};t.m=e,t.c=s,t.d=function(e,s,n){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,s){(function(t){function n(e,t){return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,t.prototype}function i(e,t){try{return e[t]}catch(e){return}}function r(e,t,s){for(var n=t||{},o=2;o<arguments.length;++o){var c=arguments[o];if(void 0!==c&&null!==c)for(var a in c)if(c.hasOwnProperty(a)){var u=i(c,a),h=i(n,a);if(u!==t&&void 0!==u)if(e&&"object"==typeof u&&null!==u)if(u instanceof Array)n[a]=r(e,h instanceof Array?h:[],u);else{var f="object"!=typeof h||h instanceof Array?{}:h;n[a]=r(e,f,u)}else n[a]=u}}return n}function o(e,t){return-1!==e.indexOf(t,e.length-t.length)}function c(e,t){return 0===e.lastIndexOf(t,0)}function a(e){return"/"===e.substring(e.length-1)&&(e=e.substring(0,e.length-1)),e}function u(e){return void 0!==e&&null!==e&&("string"==typeof e||e instanceof String)}function h(e){return void 0!==e&&null!==e&&"function"==typeof e}function f(e,s){if(t.console){var n=t.console[e];h(n)&&n.apply(t.console,s)}}function _(e,t,s){var n=.5*Math.random(),i=t*Math.pow(2,e+1);return i>s&&(i=s),Math.floor((1-n)*i)}function l(e){return"error"in e&&null!==e.error&&""!==e.error}function g(e){this._sockJS=null,this._isSockJS=!1,this._status="disconnected",this._reconnect=!0,this._reconnecting=!1,this._transport=null,this._transportName=null,this._transportClosed=!0,this._messageId=0,this._clientID=null,this._subs={},this._lastMessageID={},this._messages=[],this._isBatching=!1,this._isAuthBatching=!1,this._authChannels={},this._numRefreshFailed=0,this._refreshTimeout=null,this._pingInterval=null,this._pongTimeout=null,this._retries=0,this._callbacks={},this._latency=null,this._latencyStart=null,this._config={sockJS:null,retry:1e3,maxRetry:2e4,timeout:5e3,info:"",resubscribe:!0,ping:!0,pingInterval:3e4,pongWaitTimeout:5e3,debug:!1,insecure:!1,server:null,privateChannelPrefix:"$",onTransportClose:null,transports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh/",refreshHeaders:{},refreshParams:{},refreshData:{},refreshTransport:"ajax",refreshCallback:null,refreshAttempts:null,refreshInterval:3e3,refreshFailed:null,authEndpoint:"/centrifuge/auth/",authHeaders:{},authParams:{},authTransport:"ajax",authCallback:null,decodeJSON:!0},e&&this.configure(e)}function d(e,t,s){this._status=p,this._error=null,this._centrifuge=e,this.channel=t,this._setEvents(s),this._isResubscribe=!1,this._recovered=!1,this._ready=!1,this._promise=null,this._initializePromise()}var b=s(2);Object.create||(Object.create=function(){var e=function(){};return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),n(g,b),g._jsonpCallbacks={},g._jsonpTimeouts={},g._nextJSONPCallbackID=1,g.prototype={_jsonp:function(e,s,n,i,r){n.length>0&&this._log("Only AJAX request allows to send custom headers, it is not possible with JSONP."),self._debug("sending JSONP request to",e);var o="centrifuge_jsonp_"+g._nextJSONPCallbackID.toString();g._nextJSONPCallbackID++;var c=t.document,a=c.createElement("script"),u=setTimeout(function(){g._jsonpCallbacks[o]=function(){},r(!0,"timeout")},3e3);g._jsonpCallbacks[o]=function(e){clearTimeout(u),r(!1,e),delete g[o]};var h="";for(var f in s)s.hasOwnProperty(f)&&(h.length>0&&(h+="&"),h+=encodeURIComponent(f)+"="+encodeURIComponent(s[f]));var _="Centrifuge._jsonpCallbacks['"+o+"']";a.src=this._config.authEndpoint+"?callback="+encodeURIComponent(_)+"&data="+encodeURIComponent(JSON.stringify(i))+"&"+h;var l=c.getElementsByTagName("head")[0]||c.documentElement;l.insertBefore(a,l.firstChild)},_ajax:function(e,s,n,i,r){var o=this;o._debug("sending AJAX request to",e);var c=t.XMLHttpRequest?new t.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a="";for(var u in s)s.hasOwnProperty(u)&&(a.length>0&&(a+="&"),a+=encodeURIComponent(u)+"="+encodeURIComponent(s[u]));a.length>0&&(a="?"+a),c.open("POST",e+a,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-Type","application/json");for(var h in n)n.hasOwnProperty(h)&&c.setRequestHeader(h,n[h]);return c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var e,t=!1;try{e=JSON.parse(c.responseText),t=!0}catch(e){r(!0,"JSON returned was invalid, yet status code was 200. Data was: "+c.responseText)}t&&r(!1,e)}else o._log("Could not get auth info from application",c.status),r(!0,c.status)},setTimeout(function(){c.send(JSON.stringify(i))},20),c},_log:function(){f("info",arguments)},_debug:function(){!0===this._config.debug&&f("debug",arguments)},_websocketSupported:function(){return!("function"!=typeof WebSocket&&"object"!=typeof WebSocket)},_sockjsEndpoint:function(){var e=this._config.url;return e=e.replace("ws://","http://").replace("wss://","https://"),e=a(e),o(this._config.url,"connection")||(e+="/connection"),e},_rawWebsocketEndpoint:function(){var e=this._config.url;return e=e.replace("http://","ws://").replace("https://","wss://"),e=a(e),o(this._config.url,"connection/websocket")||(e+="/connection/websocket"),e},_configure:function(e){if(this._debug("Configuring centrifuge object with",e),e||(e={}),this._config=r(!1,this._config,e),!this._config.url)throw"Missing required configuration parameter 'url' specifying server URL";if(!this._config.user&&""!==this._config.user){if(!this._config.insecure)throw"Missing required configuration parameter 'user' specifying user's unique ID in your application";this._debug("user not found but this is OK for insecure mode - anonymous access will be used"),this._config.user=""}if(!this._config.timestamp){if(!this._config.insecure)throw"Missing required configuration parameter 'timestamp'";this._debug("token not found but this is OK for insecure mode")}if(!this._config.token){if(!this._config.insecure)throw"Missing required configuration parameter 'token' specifying the sign of authorization request";this._debug("timestamp not found but this is OK for insecure mode")}if(this._config.url=a(this._config.url),o(this._config.url,"connection"))if(this._debug("client will connect to SockJS endpoint"),null!==this._config.sockJS)this._debug("SockJS explicitly provided in options"),this._sockJS=this._config.sockJS;else{if("undefined"==typeof SockJS)throw"include SockJS client library before Centrifuge javascript client library or provide SockJS object in options or use raw Websocket connection endpoint";this._debug("use globally defined SockJS"),this._sockJS=SockJS}else o(this._config.url,"connection/websocket")?this._debug("client will connect to raw Websocket endpoint"):(this._debug("client will detect connection endpoint itself"),null!==this._config.sockJS?(this._debug("SockJS explicitly provided in options"),this._sockJS=this._config.sockJS):"undefined"==typeof SockJS?this._debug("SockJS not found"):(this._debug("use globally defined SockJS"),this._sockJS=SockJS))},_setStatus:function(e){this._status!==e&&(this._debug("Status",this._status,"->",e),this._status=e)},_isConnecting:function(){return"connecting"===this._status},_nextMessageId:function(){return++this._messageId},_resetRetry:function(){this._debug("reset retries count to 0"),this._retries=0},_getRetryInterval:function(){var e=_(this._retries,this._config.retry,this._config.maxRetry);return this._retries+=1,e},_clearConnectedState:function(e){this._clientID=null;for(var t in this._callbacks)if(this._callbacks.hasOwnProperty(t)){var s=this._callbacks[t],n=s.errback;n&&n(this._createErrorObject("disconnected","retry"))}this._callbacks={};for(var i in this._subs)if(this._subs.hasOwnProperty(i)){var r=this._subs[i];e?(r._isSuccess()&&r._triggerUnsubscribe(),r._setSubscribing()):r._setUnsubscribed()}this._config.resubscribe&&this._reconnect||(this._subs={})},_send:function(e){0!==e.length&&(1===e.length&&(e=e[0]),this._debug("Send",e),this._transport.send(JSON.stringify(e)))},_setupTransport:function(){var e=this;if(this._isSockJS=!1,null!==this._sockJS){var t={transports:this._config.transports};null!==this._config.server&&(t.server=this._config.server),this._isSockJS=!0,this._transport=new this._sockJS(this._sockjsEndpoint(),null,t)}else{if(!this._websocketSupported())return void this._debug("No Websocket support and no SockJS configured, can not connect");this._transport=new WebSocket(this._rawWebsocketEndpoint())}this._transport.onopen=function(){e._transportClosed=!1,e._reconnecting=!1,e._isSockJS?(e._transportName=e._transport.transport,e._transport.onheartbeat=function(){e._restartPing()}):e._transportName="raw-websocket",e._resetRetry(),u(e._config.user)||e._log("user expected to be string"),u(e._config.info)||e._log("info expected to be string");var t={method:"connect",params:{user:e._config.user,info:e._config.info}};e._config.insecure||(t.params.timestamp=e._config.timestamp,t.params.token=e._config.token,u(e._config.timestamp)||e._log("timestamp expected to be string"),u(e._config.token)||e._log("token expected to be string")),e._addMessage(t),e._latencyStart=new Date},this._transport.onerror=function(t){e._debug("transport level error",t)},this._transport.onclose=function(t){e._transportClosed=!0;var s="connection closed",n=!0;if(t&&"reason"in t&&t.reason)try{var i=JSON.parse(t.reason);e._debug("reason is an advice object",i),s=i.reason,n=i.reconnect}catch(i){s=t.reason,e._debug("reason is a plain string",s),n="disconnect"!==s}if(null!==e._config.onTransportClose&&e._config.onTransportClose({event:t,reason:s,reconnect:n}),e._disconnect(s,n),!0===e._reconnect){e._reconnecting=!0;var r=e._getRetryInterval();e._debug("reconnect after "+r+" milliseconds"),setTimeout(function(){!0===e._reconnect&&e.connect.call(e)},r)}},this._transport.onmessage=function(t){var s=this._config.decodeJSON?JSON.parse(t.data):t.data;console.log(t),e._debug("Received",s),e._receive(s),e._restartPing()}},_disconnect:function(e,t){if(!this.isDisconnected()){this._debug("disconnected:",e,t);var s=t||!1;if(!1===s&&(this._reconnect=!1),this._clearConnectedState(t),!this.isDisconnected()){this._setStatus("disconnected");var n={reason:e,reconnect:s};this._refreshTimeout&&clearTimeout(this._refreshTimeout),!1===this._reconnecting&&this.trigger("disconnect",[n])}this._transportClosed||this._transport.close()}},_refreshFailed:function(){self._numRefreshFailed=0,this.isDisconnected()||this._disconnect("refresh failed",!1),null!==this._config.refreshFailed&&this._config.refreshFailed()},_refresh:function(){var e=this;if(this._debug("refresh credentials"),0===e._config.refreshAttempts)return this._debug("refresh attempts set to 0, do not send refresh request at all"),void e._refreshFailed();null!==e._refreshTimeout&&clearTimeout(e._refreshTimeout);var t=function(t,s){if(!0===t)return e._debug("error getting connection credentials from refresh endpoint",s),e._numRefreshFailed++,e._refreshTimeout&&clearTimeout(e._refreshTimeout),null!==e._config.refreshAttempts&&e._numRefreshFailed>=e._config.refreshAttempts?void e._refreshFailed():void(e._refreshTimeout=setTimeout(function(){e._refresh.call(e)},e._config.refreshInterval+Math.round(1e3*Math.random())));if(e._numRefreshFailed=0,e._config.user=s.user,e._config.timestamp=s.timestamp,"info"in s&&(e._config.info=s.info),e._config.token=s.token,e.isDisconnected())e._debug("credentials refreshed, connect from scratch"),e.connect();else{e._debug("send refreshed credentials");var n={method:"refresh",params:{user:e._config.user,timestamp:e._config.timestamp,info:e._config.info,token:e._config.token}};e._addMessage(n)}},s=this._config.refreshTransport.toLowerCase();if("ajax"===s)this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,t);else if("jsonp"===s)this._jsonp(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,t);else{if("custom"!==s)throw"Unknown refresh transport "+s;if(!this._config.refreshCallback)throw"Missing 'authCallback' for custom refresh transport";this._config.refreshCallback(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,data,t)}},_subscribe:function(e){var t=e.channel;if(t in this._subs||(this._subs[t]=e),!this.isConnected())return void e._setNew();e._setSubscribing();var s={method:"subscribe",params:{channel:t}};c(t,this._config.privateChannelPrefix)?this._isAuthBatching?this._authChannels[t]=!0:(this.startAuthBatching(),this._subscribe(e),this.stopAuthBatching()):(!0===this._recover(t)&&(s.params.recover=!0,s.params.last=this._getLastID(t)),this._addMessage(s))},_unsubscribe:function(e){if(this.isConnected()){var t={method:"unsubscribe",params:{channel:e.channel}};this._addMessage(t)}},_getSub:function(e){return this._subs[e]||null},_connectResponse:function(e){if(!this.isConnected())if(l(e))this.trigger("error",[{message:e}]);else{if(null!==this._latencyStart&&(this._latency=(new Date).getTime()-this._latencyStart.getTime(),this._latencyStart=null),!e.body)return;if(e.body.expires){var t=e.body.expired;if(t)return this._reconnecting=!0,this._disconnect("expired",!0),void this._refresh()}this._clientID=e.body.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout);var s=this;if(e.body.expires&&(this._refreshTimeout=setTimeout(function(){s._refresh.call(s)},1e3*e.body.ttl)),this._config.resubscribe){this.startBatching(),this.startAuthBatching();for(var n in this._subs)if(this._subs.hasOwnProperty(n)){var i=this._subs[n];this._subscribe(i)}this.stopAuthBatching(),this.stopBatching(!0)}var r={client:e.body.client,transport:this._transportName,latency:this._latency};this._restartPing(),this.trigger("connect",[r])}},_stopPing:function(){null!==this._pongTimeout&&clearTimeout(this._pongTimeout),null!==this._pingInterval&&clearInterval(this._pingInterval)},_startPing:function(){if(!(!0!==this._config.ping||this._config.pingInterval<=0)&&this.isConnected()){var e=this;this._pingInterval=setInterval(function(){if(!e.isConnected())return void e._stopPing();e.ping(),e._pongTimeout=setTimeout(function(){e._disconnect("no ping",!0)},e._config.pongWaitTimeout)},this._config.pingInterval)}},_restartPing:function(){this._stopPing(),this._startPing()},_disconnectResponse:function(e){if(l(e))this.trigger("error",[{message:e}]);else{var t=!1;"reconnect"in e.body&&(t=e.body.reconnect);var s="";"reason"in e.body&&(s=e.body.reason),this._disconnect(s,t)}},_subscribeResponse:function(e){var t=e.body;if(null!==t){var s=t.channel,n=this._getSub(s);if(n&&n._isSubscribing())if(l(e))this.trigger("error",[{message:e}]),n._setSubscribeError(this._errorObjectFromMessage(e));else{var i=t.messages;if(i&&i.length>0){i=i.reverse();for(var r in i)i.hasOwnProperty(r)&&this._messageResponse({body:i[r]})}else"last"in t&&(this._lastMessageID[s]=t.last);var o=!1;"recovered"in t&&(o=t.recovered),n._setSubscribeSuccess(o)}}},_unsubscribeResponse:function(e){var t=e.uid,s=e.body,n=s.channel,i=this._getSub(n);i&&(l(e)?this.trigger("error",[{message:e}]):t||i._setUnsubscribed())},_publishResponse:function(e){var t=e.uid,s=e.body;if(t in this._callbacks){var n=this._callbacks[t];if(delete this._callbacks[t],l(e)){var i=n.errback;if(!i)return;i(this._errorObjectFromMessage(e)),this.trigger("error",[{message:e}])}else{var r=n.callback;if(!r)return;r(s)}}},_presenceResponse:function(e){var t=e.uid,s=e.body;if(t in this._callbacks){var n=this._callbacks[t];if(delete this._callbacks[t],l(e)){var i=n.errback;if(!i)return;i(this._errorObjectFromMessage(e)),this.trigger("error",[{message:e}])}else{var r=n.callback;if(!r)return;r(s)}}},_historyResponse:function(e){var t=e.uid,s=e.body;if(t in this._callbacks){var n=this._callbacks[t];if(delete this._callbacks[t],l(e)){var i=n.errback;if(!i)return;i(this._errorObjectFromMessage(e)),this.trigger("error",[{message:e}])}else{var r=n.callback;if(!r)return;r(s)}}},_joinResponse:function(e){var t=e.body,s=t.channel,n=this._getSub(s);n&&n.trigger("join",[t])},_leaveResponse:function(e){var t=e.body,s=t.channel,n=this._getSub(s);n&&n.trigger("leave",[t])},_messageResponse:function(e){var t=e.body,s=t.channel;this._lastMessageID[s]=t.uid;var n=this._getSub(s);n&&n.trigger("message",[t])},_refreshResponse:function(e){if(this._refreshTimeout&&clearTimeout(this._refreshTimeout),l(e))this.trigger("error",[{message:e}]);else if(e.body.expires){var t=this,s=e.body.expired;if(s)return void(t._refreshTimeout=setTimeout(function(){t._refresh.call(t)},t._config.refreshInterval+Math.round(1e3*Math.random())));this._clientID=e.body.client,t._refreshTimeout=setTimeout(function(){t._refresh.call(t)},1e3*e.body.ttl)}},_dispatchMessage:function(e){if(void 0===e||null===e)return void this._debug("dispatch: got undefined or null message");var t=e.method;if(!t)return void this._debug("dispatch: got message with empty method");switch(t){case"connect":this._connectResponse(e);break;case"disconnect":this._disconnectResponse(e);break;case"subscribe":this._subscribeResponse(e);break;case"unsubscribe":this._unsubscribeResponse(e);break;case"publish":this._publishResponse(e);break;case"presence":this._presenceResponse(e);break;case"history":this._historyResponse(e);break;case"join":this._joinResponse(e);break;case"leave":this._leaveResponse(e);break;case"ping":break;case"refresh":this._refreshResponse(e);break;case"message":this._messageResponse(e);break;default:this._debug("dispatch: got message with unknown method"+t)}},_receive:function(e){if(Object.prototype.toString.call(e)===Object.prototype.toString.call([])){for(var t in e)if(e.hasOwnProperty(t)){var s=e[t];this._dispatchMessage(s)}}else Object.prototype.toString.call(e)===Object.prototype.toString.call({})&&this._dispatchMessage(e)},_flush:function(){var e=this._messages.slice(0);this._messages=[],this._send(e)},_recover:function(e){return e in this._lastMessageID},_getLastID:function(e){var t=this._lastMessageID[e];return t?(this._debug("last uid found and sent for channel",e),t):(this._debug("no last uid found for channel",e),"")},_createErrorObject:function(e,t){var s={error:e};return t&&(s.advice=t),s},_errorObjectFromMessage:function(e){return this._createErrorObject(e.error,e.advice)},_registerCall:function(e,t,s){var n=this;this._callbacks[e]={callback:t,errback:s},setTimeout(function(){delete n._callbacks[e],h(s)&&s(n._createErrorObject("timeout","retry"))},this._config.timeout)},_addMessage:function(e){var t=""+this._nextMessageId();return e.uid=t,!0===this._isBatching?this._messages.push(e):this._send([e]),t},getClientId:function(){return this._clientID},configure:function(e){this._configure.call(this,e)},disconnect:function(){this._disconnect("client",!1)},startBatching:function(){this._isBatching=!0},stopBatching:function(e){e=e||!1,this._isBatching=!1,!0===e&&this.flush()},flush:function(){this._flush()},startAuthBatching:function(){this._isAuthBatching=!0},stopAuthBatching:function(){this._isAuthBatching=!1;var e=this._authChannels;this._authChannels={};var t=[];for(var s in e)if(e.hasOwnProperty(s)){var n=this._getSub(s);n&&t.push(s)}if(0!==t.length){var i={client:this.getClientId(),channels:t},r=this,o=function(e,s){var n,i;if(!0!==e){var o=!1;r._isBatching||(r.startBatching(),o=!0);for(n in t){i=t[n];var c=s[i];if(c)if(c.status&&200!==c.status)r._subscribeResponse({error:c.status,body:{channel:i}});else{var a={method:"subscribe",params:{channel:i,client:r.getClientId(),info:c.info,sign:c.sign}},u=r._recover(i);!0===u&&(a.params.recover=!0,a.params.last=r._getLastID(i)),r._addMessage(a)}else r._subscribeResponse({error:"channel not found in authorization response",advice:"fix",body:{channel:i}})}o&&r.stopBatching(!0)}else{r._debug("authorization request failed");for(n in t)i=t[n],r._subscribeResponse({error:"authorization request failed",advice:"fix",body:{channel:i}})}},c=this._config.authTransport.toLowerCase();if("ajax"===c)this._ajax(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,i,o);else if("jsonp"===c)this._jsonp(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,i,o);else{if("custom"!==c)throw"Unknown auth transport "+c;if(!this._config.authCallback)throw"Missing 'authCallback' for custom auth transport";this._config.authCallback(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,i,o)}}},subscribe:function(e,t){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(!this._config.resubscribe&&!this.isConnected())throw"Can not only subscribe in connected state when resubscribe option is off";var s=this._getSub(e);if(null!==s)return s._setEvents(t),s._isUnsubscribed()&&s.subscribe(),s;var n=new d(this,e,t);return this._subs[e]=n,n.subscribe(),n},ping:function(){this._addMessage({method:"ping"})},isConnected:function(){return"connected"===this._status},isDisconnected:function(){return"disconnected"===this._status},connect:function(e){if(this.isConnected())return void this._debug("connect called when already connected");"connecting"!==this._status&&(this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,e&&this.on("connect",e),this._setupTransport())}};var p=0;n(d,b),d.prototype={_initializePromise:function(){this._ready=!1;var e=this;this._promise=new Promise(function(t,s){e._resolve=function(s){e._ready=!0,t(s)},e._reject=function(t){e._ready=!0,s(t)}})},_setEvents:function(e){if(e)if(h(e))this.on("message",e);else if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))for(var t=["message","join","leave","unsubscribe","subscribe","error"],s=0,n=t.length;s<n;s++){var i=t[s];i in e&&this.on(i,e[i])}},_isNew:function(){return this._status===p},_isUnsubscribed:function(){return 4===this._status},_isSubscribing:function(){return 1===this._status},_isReady:function(){return 2===this._status||3===this._status},_isSuccess:function(){return 2===this._status},_isError:function(){return 3===this._status},_setNew:function(){this._status=p},_setSubscribing:function(){!0===this._ready&&(this._initializePromise(),this._isResubscribe=!0),this._status=1},_setSubscribeSuccess:function(e){if(2!==this._status){this._recovered=e,this._status=2;var t=this._getSubscribeSuccessContext(e);this.trigger("subscribe",[t]),this._resolve(t)}},_setSubscribeError:function(e){if(3!==this._status){this._status=3,this._error=e;var t=this._getSubscribeErrorContext();this.trigger("error",[t]),this._reject(t)}},_triggerUnsubscribe:function(){var e={channel:this.channel};this.trigger("unsubscribe",[e])},_setUnsubscribed:function(){4!==this._status&&(this._status=4,this._triggerUnsubscribe())},_getSubscribeSuccessContext:function(){return{channel:this.channel,isResubscribe:this._isResubscribe,recovered:this._recovered}},_getSubscribeErrorContext:function(){var e=this._error;return e.channel=this.channel,e.isResubscribe=this._isResubscribe,e},ready:function(e,t){this._ready&&(this._isSuccess()?e(this._getSubscribeSuccessContext()):t(this._getSubscribeErrorContext()))},subscribe:function(){if(2!==this._status)return this._centrifuge._subscribe(this),this},unsubscribe:function(){this._setUnsubscribed(),this._centrifuge._unsubscribe(this)},publish:function(e){var t=this;return new Promise(function(s,n){if(t._isUnsubscribed())return void n(t._centrifuge._createErrorObject("subscription unsubscribed","fix"));t._promise.then(function(){if(!t._centrifuge.isConnected())return void n(t._centrifuge._createErrorObject("disconnected","retry"));var i={method:"publish",params:{channel:t.channel,data:e}},r=t._centrifuge._addMessage(i);t._centrifuge._registerCall(r,s,n)},function(e){n(e)})})},presence:function(){var e=this;return new Promise(function(t,s){if(e._isUnsubscribed())return void s(e._centrifuge._createErrorObject("subscription unsubscribed","fix"));e._promise.then(function(){if(!e._centrifuge.isConnected())return void s(e._centrifuge._createErrorObject("disconnected","retry"));var n={method:"presence",params:{channel:e.channel}},i=e._centrifuge._addMessage(n);e._centrifuge._registerCall(i,t,s)},function(e){s(e)})})},history:function(){var e=this;return new Promise(function(t,s){if(e._isUnsubscribed())return void s(e._centrifuge._createErrorObject("subscription unsubscribed","fix"));e._promise.then(function(){if(!e._centrifuge.isConnected())return void s(e._centrifuge._createErrorObject("disconnected","retry"));var n={method:"history",params:{channel:e.channel}},i=e._centrifuge._addMessage(n);e._centrifuge._registerCall(i,t,s)},function(e){s(e)})})}},e.exports=g}).call(t,s(1))},function(e,t){var s;s=function(){return this}();try{s=s||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(s=window)}e.exports=s},function(e,t,s){var n;!function(t){"use strict";function i(){}function r(e,t){for(var s=e.length;s--;)if(e[s].listener===t)return s;return-1}function o(e){return function(){return this[e].apply(this,arguments)}}function c(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&c(e.listener)}var a=i.prototype,u=t.EventEmitter;a.getListeners=function(e){var t,s,n=this._getEvents();if(e instanceof RegExp){t={};for(s in n)n.hasOwnProperty(s)&&e.test(s)&&(t[s]=n[s])}else t=n[e]||(n[e]=[]);return t},a.flattenListeners=function(e){var t,s=[];for(t=0;t<e.length;t+=1)s.push(e[t].listener);return s},a.getListenersAsObject=function(e){var t,s=this.getListeners(e);return s instanceof Array&&(t={},t[e]=s),t||s},a.addListener=function(e,t){if(!c(t))throw new TypeError("listener must be a function");var s,n=this.getListenersAsObject(e),i="object"==typeof t;for(s in n)n.hasOwnProperty(s)&&-1===r(n[s],t)&&n[s].push(i?t:{listener:t,once:!1});return this},a.on=o("addListener"),a.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},a.once=o("addOnceListener"),a.defineEvent=function(e){return this.getListeners(e),this},a.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},a.removeListener=function(e,t){var s,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(s=r(i[n],t))&&i[n].splice(s,1);return this},a.off=o("removeListener"),a.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},a.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},a.manipulateListeners=function(e,t,s){var n,i,r=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=s.length;n--;)r.call(this,t,s[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?r.call(this,n,i):o.call(this,n,i));return this},a.removeEvent=function(e){var t,s=typeof e,n=this._getEvents();if("string"===s)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},a.removeAllListeners=o("removeEvent"),a.emitEvent=function(e,t){var s,n,i,r,o=this.getListenersAsObject(e);for(r in o)if(o.hasOwnProperty(r))for(s=o[r].slice(0),i=0;i<s.length;i++)n=s[i],!0===n.once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},a.trigger=o("emitEvent"),a.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},a.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},a._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},a._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=u,i},void 0!==(n=function(){return i}.call(t,s,t,e))&&(e.exports=n)}(this||{})}]);