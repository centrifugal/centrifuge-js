(()=>{var le=Object.create;var U=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames,H=Object.getOwnPropertySymbols,pe=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var B=(o,i,e)=>i in o?U(o,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[i]=e,q=(o,i)=>{for(var e in i||(i={}))K.call(i,e)&&B(o,e,i[e]);if(H)for(var e of H(i))de.call(i,e)&&B(o,e,i[e]);return o};var _e=(o,i)=>()=>(i||o((i={exports:{}}).exports,i),i.exports);var be=(o,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of fe(i))!K.call(o,n)&&n!==e&&U(o,n,{get:()=>i[n],enumerable:!(t=he(i,n))||t.enumerable});return o};var G=(o,i,e)=>(e=o!=null?le(pe(o)):{},be(i||!o||!o.__esModule?U(e,"default",{value:o,enumerable:!0}):e,o));var b=(o,i,e)=>new Promise((t,n)=>{var s=a=>{try{c(e.next(a))}catch(h){n(h)}},r=a=>{try{c(e.throw(a))}catch(h){n(h)}},c=a=>a.done?t(a.value):Promise.resolve(a.value).then(s,r);c((e=e.apply(o,i)).next())});var z=_e((ke,N)=>{"use strict";var y=typeof Reflect=="object"?Reflect:null,Q=y&&typeof y.apply=="function"?y.apply:function(i,e,t){return Function.prototype.apply.call(i,e,t)},w;y&&typeof y.ownKeys=="function"?w=y.ownKeys:Object.getOwnPropertySymbols?w=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:w=function(i){return Object.getOwnPropertyNames(i)};function me(o){console&&console.warn&&console.warn(o)}var X=Number.isNaN||function(i){return i!==i};function l(){l.init.call(this)}N.exports=l;N.exports.once=Se;l.EventEmitter=l;l.prototype._events=void 0;l.prototype._eventsCount=0;l.prototype._maxListeners=void 0;var V=10;function P(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return V},set:function(o){if(typeof o!="number"||o<0||X(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");V=o}});l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};l.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||X(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function Y(o){return o._maxListeners===void 0?l.defaultMaxListeners:o._maxListeners}l.prototype.getMaxListeners=function(){return Y(this)};l.prototype.emit=function(i){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var n=i==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var c=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw c.context=r,c}var a=s[i];if(a===void 0)return!1;if(typeof a=="function")Q(a,this,e);else for(var h=a.length,v=ne(a,h),t=0;t<h;++t)Q(v[t],this,e);return!0};function Z(o,i,e,t){var n,s,r;if(P(e),s=o._events,s===void 0?(s=o._events=Object.create(null),o._eventsCount=0):(s.newListener!==void 0&&(o.emit("newListener",i,e.listener?e.listener:e),s=o._events),r=s[i]),r===void 0)r=s[i]=e,++o._eventsCount;else if(typeof r=="function"?r=s[i]=t?[e,r]:[r,e]:t?r.unshift(e):r.push(e),n=Y(o),n>0&&r.length>n&&!r.warned){r.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=o,c.type=i,c.count=r.length,me(c)}return o}l.prototype.addListener=function(i,e){return Z(this,i,e,!1)};l.prototype.on=l.prototype.addListener;l.prototype.prependListener=function(i,e){return Z(this,i,e,!0)};function ge(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $(o,i,e){var t={fired:!1,wrapFn:void 0,target:o,type:i,listener:e},n=ge.bind(t);return n.listener=e,t.wrapFn=n,n}l.prototype.once=function(i,e){return P(e),this.on(i,$(this,i,e)),this};l.prototype.prependOnceListener=function(i,e){return P(e),this.prependListener(i,$(this,i,e)),this};l.prototype.removeListener=function(i,e){var t,n,s,r,c;if(P(e),n=this._events,n===void 0)return this;if(t=n[i],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[i],n.removeListener&&this.emit("removeListener",i,t.listener||e));else if(typeof t!="function"){for(s=-1,r=t.length-1;r>=0;r--)if(t[r]===e||t[r].listener===e){c=t[r].listener,s=r;break}if(s<0)return this;s===0?t.shift():ve(t,s),t.length===1&&(n[i]=t[0]),n.removeListener!==void 0&&this.emit("removeListener",i,c||e)}return this};l.prototype.off=l.prototype.removeListener;l.prototype.removeAllListeners=function(i){var e,t,n;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[i]),this;if(arguments.length===0){var s=Object.keys(t),r;for(n=0;n<s.length;++n)r=s[n],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[i],typeof e=="function")this.removeListener(i,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(i,e[n]);return this};function ee(o,i,e){var t=o._events;if(t===void 0)return[];var n=t[i];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?ye(n):ne(n,n.length)}l.prototype.listeners=function(i){return ee(this,i,!0)};l.prototype.rawListeners=function(i){return ee(this,i,!1)};l.listenerCount=function(o,i){return typeof o.listenerCount=="function"?o.listenerCount(i):te.call(o,i)};l.prototype.listenerCount=te;function te(o){var i=this._events;if(i!==void 0){var e=i[o];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?w(this._events):[]};function ne(o,i){for(var e=new Array(i),t=0;t<i;++t)e[t]=o[t];return e}function ve(o,i){for(;i+1<o.length;i++)o[i]=o[i+1];o.pop()}function ye(o){for(var i=new Array(o.length),e=0;e<i.length;++e)i[e]=o[e].listener||o[e];return i}function Se(o,i){return new Promise(function(e,t){function n(r){o.removeListener(i,s),t(r)}function s(){typeof o.removeListener=="function"&&o.removeListener("error",n),e([].slice.call(arguments))}se(o,i,s,{once:!0}),i!=="error"&&xe(o,n,{once:!0})})}function xe(o,i,e){typeof o.on=="function"&&se(o,"error",i,e)}function se(o,i,e,t){if(typeof o.on=="function")t.once?o.once(i,e):o.on(i,e);else if(typeof o.addEventListener=="function")o.addEventListener(i,function n(s){t.once&&o.removeEventListener(i,n),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}});var ce=G(z());var f={timeout:1,transportClosed:2,clientDisconnected:3,clientClosed:4,clientConnectToken:5,clientRefreshToken:6,subscriptionUnsubscribed:7,subscriptionSubscribeToken:8,subscriptionRefreshToken:9,transportWriteError:10,connectionClosed:11},S={connectCalled:0,transportClosed:1,noPing:2,subscribeTimeout:3,unsubscribeError:4},R={disconnectCalled:0,unauthorized:1,badProtocol:2,messageSizeLimit:3},O={subscribeCalled:0,transportClosed:1},J={unsubscribeCalled:0,unauthorized:1,clientClosed:2};var W=(t=>(t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t))(W||{}),L=(t=>(t.Unsubscribed="unsubscribed",t.Subscribing="subscribing",t.Subscribed="subscribed",t))(L||{});function ie(o,i){return o.lastIndexOf(i,0)===0}function F(o){return o==null?!1:typeof o=="function"}function re(o,i){if(window.console){let e=window.console[o];F(e)&&e.apply(window.console,i)}}function Ce(o,i){return Math.floor(Math.random()*(i-o+1)+o)}function x(o,i,e){o>31&&(o=31);let t=Ce(0,Math.min(e,i*Math.pow(2,o)));return Math.min(e,i+t)}function oe(o){return"error"in o&&o.error!==null}function C(o){return Math.min(o*1e3,2147483647)}var j=class extends ce.default{constructor(e,t,n){super();this._resubscribeTimeout=null;this._refreshTimeout=null;this.channel=t,this.state="unsubscribed",this._centrifuge=e,this._token=null,this._getToken=null,this._data=null,this._recover=!1,this._offset=null,this._epoch=null,this._recoverable=!1,this._positioned=!1,this._minResubscribeDelay=500,this._maxResubscribeDelay=2e4,this._resubscribeTimeout=null,this._resubscribeAttempts=0,this._promises=new Map,this._promiseId=0,this._refreshTimeout=null,this._setOptions(n),this._centrifuge._debugEnabled&&(this.on("state",s=>{this._centrifuge._debug("subscription state",t,s.oldState,"->",s.newState)}),this.on("error",s=>{this._centrifuge._debug("subscription error",t,s)}))}ready(e){return this.state==="unsubscribed"?Promise.reject({code:f.subscriptionUnsubscribed,message:this.state}):this.state==="subscribed"?Promise.resolve():new Promise((t,n)=>{let s={resolve:t,reject:n};e&&(s.timeout=setTimeout(function(){n({code:f.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=s})}subscribe(){this._isSubscribed()||(this._resubscribeAttempts=0,this._setSubscribing(O.subscribeCalled,"subscribe called"))}unsubscribe(){this._setUnsubscribed(J.unsubscribeCalled,"unsubscribe called",!0)}publish(e){return b(this,null,function*(){let t=this;return this._methodCall().then(function(){return t._centrifuge.publish(t.channel,e)})})}presence(){return b(this,null,function*(){let e=this;return this._methodCall().then(function(){return e._centrifuge.presence(e.channel)})})}presenceStats(){return b(this,null,function*(){let e=this;return this._methodCall().then(function(){return e._centrifuge.presenceStats(e.channel)})})}history(e){return b(this,null,function*(){let t=this;return this._methodCall().then(function(){return t._centrifuge.history(t.channel,e)})})}_methodCall(){return this._isSubscribed()?Promise.resolve():new Promise((e,t)=>{let n=setTimeout(function(){t({code:f.timeout,message:"timeout"})},this._centrifuge._config.timeout);this._promises[this._nextPromiseId()]={timeout:n,resolve:e,reject:t}})}_nextPromiseId(){return++this._promiseId}_needRecover(){return this._recover===!0}_isUnsubscribed(){return this.state==="unsubscribed"}_isSubscribing(){return this.state==="subscribing"}_isSubscribed(){return this.state==="subscribed"}_setState(e){if(this.state!==e){let t=this.state;return this.state=e,this.emit("state",{newState:e,oldState:t,channel:this.channel}),!0}return!1}_usesToken(){return this._token!==null||this._getToken!==null}_clearSubscribingState(){this._resubscribeAttempts=0,this._clearResubscribeTimeout()}_clearSubscribedState(){this._clearRefreshTimeout()}_setSubscribed(e){if(!this._isSubscribing())return;this._clearSubscribingState(),e.recoverable&&(this._recover=!0,this._offset=e.offset||0,this._epoch=e.epoch||""),this._setState("subscribed");let t=this._centrifuge._getSubscribeContext(this.channel,e);this.emit("subscribed",t),this._resolvePromises();let n=e.publications;if(n&&n.length>0)for(let s in n)!n.hasOwnProperty(s)||this._handlePublication(n[s]);e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),C(e.ttl)))}_setSubscribing(e,t){this._isSubscribing()||(this._isSubscribed()&&this._clearSubscribedState(),this._setState("subscribing")&&this.emit("subscribing",{channel:this.channel,code:e,reason:t}),this._centrifuge._subscribe(this))}_setUnsubscribed(e,t,n){this._isUnsubscribed()||(this._isSubscribed()&&(n&&this._centrifuge._unsubscribe(this),this._clearSubscribedState()),this._isSubscribing()&&this._clearSubscribingState(),this._setState("unsubscribed")&&this.emit("unsubscribed",{channel:this.channel,code:e,reason:t}),this._rejectPromises({code:f.subscriptionUnsubscribed,message:"unsubscribed"}))}_handlePublication(e){let t=this._centrifuge._getPublicationContext(this.channel,e);this.emit("publication",t),e.offset&&(this._offset=e.offset)}_handleJoin(e){this.emit("join",{channel:this.channel,info:this._centrifuge._getJoinLeaveContext(e.info)})}_handleLeave(e){this.emit("leave",{channel:this.channel,info:this._centrifuge._getJoinLeaveContext(e.info)})}_resolvePromises(){for(let e in this._promises)this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e]}_rejectPromises(e){for(let t in this._promises)this._promises[t].timeout&&clearTimeout(this._promises[t].timeout),this._promises[t].reject(e),delete this._promises[t]}_scheduleResubscribe(){let e=this,t=this._getResubscribeDelay();this._resubscribeTimeout=setTimeout(function(){e._isSubscribing()&&e._centrifuge._subscribe(e)},t)}_subscribeError(e){if(!!this._isSubscribing())if(e.code<100||e.code===109||e.temporary===!0){e.code===109&&(this._token=null);let t={channel:this.channel,type:"subscribe",error:e};this.emit("error",t),this._scheduleResubscribe()}else this._setUnsubscribed(e.code,e.message,!1)}_getResubscribeDelay(){let e=x(this._resubscribeAttempts,this._minResubscribeDelay,this._maxResubscribeDelay);return this._resubscribeAttempts++,e}_setOptions(e){!e||(e.since&&(this._offset=e.since.offset,this._epoch=e.since.epoch,this._recover=!0),e.data&&(this._data=e.data),e.minResubscribeDelay!==void 0&&(this._minResubscribeDelay=e.minResubscribeDelay),e.maxResubscribeDelay!==void 0&&(this._maxResubscribeDelay=e.maxResubscribeDelay),e.token&&(this._token=e.token),e.getToken&&(this._getToken=e.getToken),e.positioned===!0&&(this._positioned=!0),e.recoverable===!0&&(this._recoverable=!0))}_getOffset(){let e=this._offset;return e!==null?e:0}_getEpoch(){let e=this._epoch;return e!==null?e:""}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearResubscribeTimeout(){this._resubscribeTimeout!==null&&(clearTimeout(this._resubscribeTimeout),this._resubscribeTimeout=null)}_getSubscriptionToken(){this._centrifuge._debug("get subscription token for channel",this.channel);let e={channel:this.channel},t=this._getToken;if(t===null)throw new Error("provide a function to get channel subscription token");return t(e)}_refresh(){this._clearRefreshTimeout();let e=this;this._getSubscriptionToken().then(function(t){if(!e._isSubscribed())return;if(!t){e._failUnauthorized();return}e._token=t;let s={sub_refresh:{channel:e.channel,token:t}};e._centrifuge._call(s).then(r=>{let c=r.reply.sub_refresh;e._refreshResponse(c),r.next&&r.next()},r=>{e._refreshError(r.error),r.next&&r.next()})}).catch(function(t){e.emit("error",{type:"refreshToken",channel:e.channel,error:{code:f.subscriptionRefreshToken,message:t!==void 0?t.toString():""}}),e._refreshTimeout=setTimeout(()=>e._refresh(),e._getRefreshRetryDelay())})}_refreshResponse(e){this._centrifuge._debug("subscription token refreshed, channel",this.channel),this._clearRefreshTimeout(),e.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),C(e.ttl)))}_refreshError(e){e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",channel:this.channel,error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._setUnsubscribed(e.code,e.message,!0)}_getRefreshRetryDelay(){return x(0,1e4,2e4)}_failUnauthorized(){this._setUnsubscribed(J.unauthorized,"unauthorized",!0)}};var T=class{constructor(i,e){this.endpoint=i,this.options=e,this._transport=null}name(){return"sockjs"}subName(){return"sockjs-"+this._transport.transport}emulation(){return!1}supported(){return this.options.sockjs!==null}initialize(i,e,t){let n={transports:this.options.transports};this.options.server!==null&&(n.server=this.options.server),this.options.timeout!==null&&(n.timeout=this.options.timeout),this._transport=new this.options.sockjs(this.endpoint,null,n),this._transport.onopen=()=>{e.onOpen()},this._transport.onerror=s=>{e.onError(s)},this._transport.onclose=s=>{e.onClose(s)},this._transport.onmessage=s=>{e.onMessage(s.data)}}close(){this._transport.close()}send(i){this._transport.send(i)}};var k=class{constructor(i,e){this.endpoint=i,this.options=e,this._transport=null}name(){return"websocket"}subName(){return"websocket"}emulation(){return!1}supported(){return this.options.websocket!==void 0&&this.options.websocket!==null}initialize(i,e,t){let n="";i==="protobuf"&&(n="centrifuge-protobuf"),n!==""?this._transport=new this.options.websocket(this.endpoint,n):this._transport=new this.options.websocket(this.endpoint),i==="protobuf"&&(this._transport.binaryType="arraybuffer"),this._transport.onopen=()=>{e.onOpen()},this._transport.onerror=s=>{e.onError(s)},this._transport.onclose=s=>{e.onClose(s)},this._transport.onmessage=s=>{e.onMessage(s.data)}}close(){this._transport.close()}send(i){this._transport.send(i)}};var M=class{constructor(i,e){this.endpoint=i,this.options=e,this._abortController=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"http_stream"}subName(){return"http_stream"}emulation(){return!0}_handleErrors(i){if(!i.ok)throw new Error(i.status);return i}_fetchEventTarget(i,e,t){let n=new EventTarget;return i.options.fetch(e,t).then(i._handleErrors).then(r=>{n.dispatchEvent(new Event("open"));let c="",a=0,h=new Uint8Array,v=r.body.getReader();return new i.options.readableStream({start(u){function _(){return v.read().then(({done:d,value:p})=>{if(d){n.dispatchEvent(new Event("close")),u.close();return}try{if(i._protocol==="json")for(c+=i._utf8decoder.decode(p);a<c.length;)if(c[a]===`
`){let g=c.substring(0,a);n.dispatchEvent(new MessageEvent("message",{data:g})),c=c.substring(a+1),a=0}else++a;else{let g=new Uint8Array(h.length+p.length);for(g.set(h),g.set(p,h.length),h=g;;){let m=i.options.decoder.decodeReply(h);if(m.ok){let ue=h.slice(0,m.pos);n.dispatchEvent(new MessageEvent("message",{data:ue})),h=h.slice(m.pos);continue}break}}}catch(g){n.dispatchEvent(new Event("error",{detail:g})),n.dispatchEvent(new Event("close")),u.close();return}_()}).catch(function(d){n.dispatchEvent(new Event("error",{detail:d})),n.dispatchEvent(new Event("close")),u.close()})}return _()}})}).catch(r=>{n.dispatchEvent(new Event("error",{detail:r})),n.dispatchEvent(new Event("close"))}),n}supported(){return this.options.fetch!==null&&this.options.readableStream!==null&&typeof TextDecoder!="undefined"&&typeof AbortController!="undefined"&&typeof EventTarget!="undefined"&&typeof Event!="undefined"&&typeof MessageEvent!="undefined"&&typeof Error!="undefined"}initialize(i,e,t){this._protocol=i,this._abortController=new AbortController;let n,s;i==="json"?(n={Accept:"application/json","Content-Type":"application/json"},s=t):(n={Accept:"application/octet-stream","Content-Type":"application/octet-stream"},s=t);let r=new this._fetchEventTarget(this,this.endpoint,{method:"POST",headers:n,mode:this.options.requestMode,signal:this._abortController.signal,body:s});r.addEventListener("open",()=>{e.onOpen()}),r.addEventListener("error",c=>{this._abortController.abort(),e.onError(c)}),r.addEventListener("close",()=>{this._abortController.abort(),e.onClose({code:4,reason:"connection closed"})}),r.addEventListener("message",c=>{e.onMessage(c.data)})}close(){this._abortController.abort()}send(i,e,t){let n,s,r={session:e,node:t,data:i};this._protocol==="json"?(n={"Content-Type":"application/json"},s=JSON.stringify(r)):(n={"Content-Type":"application/octet-stream"},s=this.options.encoder.encodeEmulationRequest(r)),this.options.fetch(this.options.emulationEndpoint,{method:"POST",headers:n,mode:this.options.emulationRequestMode,body:s})}};var D=class{constructor(i,e){this.endpoint=i,this.options=e,this._protocol="json",this._transport=null,this._onClose=null}name(){return"sse"}subName(){return"sse"}emulation(){return!0}supported(){return this.options.eventsource!==null&&this.options.fetch!==null}initialize(i,e,t){let n=new URL(this.endpoint);n.searchParams.append("cf_connect",t);let s=new this.options.eventsource(n.toString());this._transport=s;let r=this;s.onopen=function(){e.onOpen()},s.onerror=function(c){s.close(),e.onError(c),e.onClose({code:4,reason:"connection closed"})},s.onmessage=function(c){e.onMessage(c.data)},r._onClose=function(){e.onClose({code:4,reason:"connection closed"})}}close(){this._transport.close(),this._onClose!==null&&this._onClose()}send(i,e,t){let n={session:e,node:t,data:i},s={"Content-Type":"application/json"},r=JSON.stringify(n);this.options.fetch(this.options.emulationEndpoint,{method:"POST",headers:s,mode:this.options.emulationRequestMode,body:r})}};var I=class{encodeCommands(i){return i.map(e=>JSON.stringify(e)).join(`
`)}},A=class{decodeReplies(i){return i.trim().split(`
`).map(e=>JSON.parse(e))}};var ae=G(z()),Ee={protocol:"json",token:null,getToken:null,data:null,debug:!1,name:"js",version:"",fetch:null,readableStream:null,websocket:null,eventsource:null,sockjs:null,sockjsServer:null,sockjsTimeout:null,sockjsTransports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],httpStreamRequestMode:"cors",emulationEndpoint:"/emulation",emulationRequestMode:"cors",minReconnectDelay:500,maxReconnectDelay:2e4,timeout:5e3,maxServerPingDelay:1e4},E=class extends ae.default{constructor(e,t){super();this._reconnectTimeout=null;this._refreshTimeout=null;this._serverPingTimeout=null;this.state="disconnected",this._endpoint=e,this._emulation=!1,this._transports=[],this._currentTransportIndex=0,this._triedAllTransports=!1,this._transportWasOpen=!1,this._transport=null,this._transportClosed=!0,this._encoder=null,this._decoder=null,this._reconnectTimeout=null,this._reconnectAttempts=0,this._client=null,this._session="",this._node="",this._subs=new Map,this._serverSubs=new Map,this._commandId=0,this._commands=[],this._batching=!1,this._refreshRequired=!1,this._refreshTimeout=null,this._callbacks={},this._token=void 0,this._dispatchPromise=Promise.resolve(),this._serverPing=0,this._serverPingTimeout=null,this._sendPong=!1,this._promises={},this._promiseId=0,this._debugEnabled=!1,this._config=q(q({},Ee),t),this._configure(),this._debugEnabled&&(this.on("state",n=>{this._debug("client state",n.oldState,"->",n.newState)}),this.on("error",n=>{this._debug("client error",n)}))}newSubscription(e,t){if(this.getSubscription(e)!==null)throw new Error("Subscription to the channel "+e+" already exists");let n=new j(this,e,t);return this._subs[e]=n,n}getSubscription(e){return this._getSub(e)}removeSubscription(e){!e||(e.state!=="unsubscribed"&&e.unsubscribe(),this._removeSubscription(e))}subscriptions(){return this._subs}ready(e){return this.state==="disconnected"?Promise.reject({code:f.clientDisconnected,message:"client disconnected"}):this.state==="connected"?Promise.resolve():new Promise((t,n)=>{let s={resolve:t,reject:n};e&&(s.timeout=setTimeout(function(){n({code:f.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=s})}connect(){if(this._isConnected()){this._debug("connect called when already connected");return}if(this._isConnecting()){this._debug("connect called when already connecting");return}this._reconnectAttempts=0,this._startConnecting()}disconnect(){this._disconnect(R.disconnectCalled,"disconnect called",!1)}send(e){return b(this,null,function*(){let t={send:{data:e}},n=this;return this._methodCall().then(function(){return n._transportSendCommands([t])?Promise.resolve():Promise.reject(n._createErrorObject(f.transportWriteError,"transport write error"))})})}rpc(e,t){return b(this,null,function*(){let n={rpc:{method:e,data:t}},s=this;return this._methodCall().then(function(){return s._callPromise(n,function(r){return{data:r.rpc.data}})})})}publish(e,t){return b(this,null,function*(){let n={publish:{channel:e,data:t}},s=this;return this._methodCall().then(function(){return s._callPromise(n,function(){return{}})})})}history(e,t){return b(this,null,function*(){let n={history:this._getHistoryRequest(e,t)},s=this;return this._methodCall().then(function(){return s._callPromise(n,function(r){let c=r.history,a=[];if(c.publications)for(let h=0;h<c.publications.length;h++)a.push(s._getPublicationContext(e,c.publications[h]));return{publications:a,epoch:c.epoch||"",offset:c.offset||0}})})})}presence(e){return b(this,null,function*(){let t={presence:{channel:e}},n=this;return this._methodCall().then(function(){return n._callPromise(t,function(s){return{clients:s.presence.presence}})})})}presenceStats(e){return b(this,null,function*(){let t={presence_stats:{channel:e}},n=this;return this._methodCall().then(function(){return n._callPromise(t,function(s){let r=s.presence_stats;return{numUsers:r.num_users,numClients:r.num_clients}})})})}startBatching(){this._batching=!0}stopBatching(){this._batching=!1,this._flush()}_debug(...e){!this._debugEnabled||re("debug",e)}_setFormat(e){if(!this._formatOverride(e)){if(e==="protobuf")throw new Error("not implemented by JSON-only Centrifuge client, use client with Protobuf support");this._encoder=new I,this._decoder=new A}}_formatOverride(e){return!1}_configure(){if(!("Promise"in window))throw new Error("Promise polyfill required");if(!this._endpoint)throw new Error("endpoint configuration required");if(this._config.protocol!=="json"&&this._config.protocol!=="protobuf")throw new Error("unsupported protocol "+this._config.protocol);if(this._config.token!==null&&(this._token=this._config.token),this._setFormat("json"),this._config.protocol==="protobuf"&&this._setFormat("protobuf"),(this._config.debug===!0||typeof localStorage!="undefined"&&localStorage.getItem("centrifuge.debug"))&&(this._debugEnabled=!0),this._debug("config",this._config),typeof this._endpoint!="string")if(typeof this._endpoint=="object"&&this._endpoint instanceof Array){this._transports=this._endpoint,this._emulation=!0;for(let e in this._transports){let t=this._transports[e];if(!t.endpoint||!t.transport)throw new Error("malformed transport configuration");let n=t.transport;if(["websocket","http_stream","sse","sockjs"].indexOf(n)<0)throw new Error("unsupported transport name: "+n)}}else throw new Error("unsupported url configuration type: only string or array of objects are supported")}_setState(e){if(this.state!==e){let t=this.state;return this.state=e,this.emit("state",{newState:e,oldState:t}),!0}return!1}_isDisconnected(){return this.state==="disconnected"}_isConnecting(){return this.state==="connecting"}_isConnected(){return this.state==="connected"}_nextCommandId(){return++this._commandId}_getReconnectDelay(){let e=x(this._reconnectAttempts,this._config.minReconnectDelay,this._config.maxReconnectDelay);return this._reconnectAttempts+=1,e}_clearOutgoingRequests(){for(let e in this._callbacks)if(this._callbacks.hasOwnProperty(e)){let t=this._callbacks[e];clearTimeout(t.timeout);let n=t.errback;if(!n)continue;n({error:this._createErrorObject(f.connectionClosed,"connection closed")})}this._callbacks={}}_clearConnectedState(){this._client=null,this._clearServerPingTimeout(),this._clearRefreshTimeout();for(let e in this._subs){if(!this._subs.hasOwnProperty(e))continue;let t=this._subs[e];t._isSubscribed()&&t._setSubscribing(O.transportClosed,"transport closed")}for(let e in this._serverSubs)this._serverSubs.hasOwnProperty(e)&&this.emit("subscribing",{channel:e})}_handleWriteError(e){for(let t of e){let n=t.id;if(!(n in this._callbacks))continue;let s=this._callbacks[n];clearTimeout(this._callbacks[n].timeout),delete this._callbacks[n],s.errback({error:this._createErrorObject(f.transportWriteError,"transport write error")})}}_transportSendCommands(e){if(!e.length)return!0;if(!this._transport)return!1;try{this._transport.send(this._encoder.encodeCommands(e),this._session,this._node)}catch(t){return this._debug("error writing commands",t),this._handleWriteError(e),!1}return!0}_initializeTransport(){let e;this._config.websocket!==null?e=this._config.websocket:typeof window.WebSocket!="function"&&typeof window.WebSocket!="object"||(e=window.WebSocket);let t=null;this._config.sockjs!==null?t=this._config.sockjs:typeof window.SockJS!="undefined"&&(t=window.SockJS);let n=null;this._config.eventsource!==null?n=this._config.eventsource:typeof window.EventSource!="undefined"&&(n=window.EventSource);let s=null;this._config.fetch!==null?s=this._config.fetch:typeof window.fetch!="undefined"&&(s=window.fetch);let r=null;if(this._config.readableStream!==null?r=this._config.readableStream:typeof window.ReadableStream!="undefined"&&(r=window.ReadableStream),this._emulation){this._currentTransportIndex>=this._transports.length&&(this._triedAllTransports=!0,this._currentTransportIndex=0);let u=0;for(;;){if(u>=this._transports.length)throw new Error("no supported transport found");let _=this._transports[this._currentTransportIndex],d=_.transport,p=_.endpoint;if(d==="websocket"){if(this._debug("trying websocket transport"),this._transport=new k(p,{websocket:e}),!this._transport.supported()){this._debug("websocket transport not available"),this._currentTransportIndex++,u++;continue}}else if(d==="http_stream"){if(this._debug("trying http_stream transport"),this._transport=new M(p,{fetch:s,readableStream:r,requestMode:this._config.httpStreamRequestMode,emulationEndpoint:this._config.emulationEndpoint,emulationRequestMode:this._config.emulationRequestMode,decoder:this._decoder,encoder:this._encoder}),!this._transport.supported()){this._debug("http_stream transport not available"),this._currentTransportIndex++,u++;continue}}else if(d==="sse"){if(this._debug("trying sse transport"),this._transport=new D(p,{eventsource:n,fetch:s,emulationEndpoint:this._config.emulationEndpoint,emulationRequestMode:this._config.emulationRequestMode}),!this._transport.supported()){this._debug("sse transport not available"),this._currentTransportIndex++,u++;continue}}else if(d==="sockjs"){if(this._debug("trying sockjs"),this._transport=new T(p,{sockjs:t,transports:this._config.sockjsTransports,server:this._config.sockjsServer,timeout:this._config.sockjsTimeout}),!this._transport.supported()){this._debug("sockjs transport not available"),this._currentTransportIndex++,u++;continue}}else throw new Error("unknown transport "+d);break}}else if(ie(this._endpoint,"http")){if(this._debug("client will use sockjs"),this._transport=new T(this._endpoint,{sockjs:t,transports:this._config.sockjsTransports,server:this._config.sockjsServer,timeout:this._config.sockjsTimeout}),!this._transport.supported())throw new Error("SockJS not available, use ws(s):// in url or include SockJS")}else if(this._debug("client will use websocket"),this._transport=new k(this._endpoint,{websocket:e}),!this._transport.supported())throw new Error("WebSocket not available");let c=this._constructConnectCommand();this._transport.emulation()&&(c.id=this._nextCommandId(),this._callConnectFake(c.id).then(u=>{let _=u.reply.connect;this._connectResponse(_),u.next&&u.next()},u=>{u.error.code>=100&&this._connectError(u.error),u.next&&u.next()}));let a=this,h,v=!1;this._transport.initialize(this._config.protocol,{onOpen:function(){v=!0,h=a._transport.subName(),a._debug(h,"transport open"),a._transportWasOpen=!0,a._transportClosed=!1,!a._transport.emulation()&&a._sendConnect()},onError:function(u){a._debug("transport level error",u)},onClose:function(u){a._debug(a._transport.name(),"transport closed"),a._transportClosed=!0;let _="connection closed",d=!0,p=0;if(u&&"code"in u&&u.code&&(p=u.code),u&&u.reason)try{let m=JSON.parse(u.reason);_=m.reason,d=m.reconnect}catch(m){_=u.reason,(p>=3500&&p<4e3||p>=4500&&p<5e3)&&(d=!1)}p<3e3?(p===1009?(p=R.messageSizeLimit,_="message size limit exceeded",d=!1):(p=S.transportClosed,_="transport closed"),a._emulation&&!a._transportWasOpen&&(a._currentTransportIndex++,a._currentTransportIndex>=a._transports.length&&(a._triedAllTransports=!0,a._currentTransportIndex=0))):a._transportWasOpen=!0;let g=!1;if(a._emulation&&!a._transportWasOpen&&!a._triedAllTransports&&(g=!0),a._isConnecting()&&!v&&a.emit("error",{type:"transport",error:{code:f.transportClosed,message:"transport closed"},transport:a._transport.name()}),a._disconnect(p,_,d),a._isConnecting()){let m=a._getReconnectDelay();g&&(m=0),a._debug("reconnect after "+m+" milliseconds"),a._reconnectTimeout=setTimeout(()=>{a._startReconnecting()},m)}},onMessage:function(u){a._dataReceived(u)}},this._encoder.encodeCommands([c]))}_sendConnect(){let e=this._constructConnectCommand(),t=this;this._call(e).then(n=>{let s=n.reply.connect;t._connectResponse(s),n.next&&n.next()},n=>{t._connectError(n.error),n.next&&n.next()})}_startReconnecting(){if(!this._isConnecting())return;if(!(this._refreshRequired||!this._token&&this._config.getToken!==null)){this._startConnecting();return}let t=this;this._getToken().then(function(n){if(!!t._isConnecting()){if(!n){t._failUnauthorized();return}t._token=n,t._debug("connection token refreshed"),t._startConnecting()}}).catch(function(n){if(!t._isConnecting())return;t.emit("error",{type:"connectToken",error:{code:f.clientConnectToken,message:n!==void 0?n.toString():""}});let s=t._getReconnectDelay();t._debug("error on connection token refresh, reconnect after "+s+" milliseconds",n),t._reconnectTimeout=setTimeout(()=>{t._startReconnecting()},s)})}_connectError(e){this.state==="connecting"&&(e.code===109&&(this._refreshRequired=!0),e.code<100||e.temporary===!0||e.code===109?(this.emit("error",{type:"connect",error:e}),this._transport&&!this._transportClosed&&(this._transportClosed=!0,this._transport.close())):this._disconnect(e.code,e.message,!1))}_constructConnectCommand(){let e={};this._token&&(e.token=this._token),this._config.data&&(e.data=this._config.data),this._config.name&&(e.name=this._config.name),this._config.version&&(e.version=this._config.version);let t={},n=!1;for(let s in this._serverSubs)if(this._serverSubs.hasOwnProperty(s)&&this._serverSubs[s].recoverable){n=!0;let r={recover:!0};this._serverSubs[s].offset&&(r.offset=this._serverSubs[s].offset),this._serverSubs[s].epoch&&(r.epoch=this._serverSubs[s].epoch),t[s]=r}return n&&(e.subs=t),{connect:e}}_getHistoryRequest(e,t){let n={channel:e};return t!==void 0&&(t.since&&(n.since={offset:t.since.offset},t.since.epoch&&(n.since.epoch=t.since.epoch)),t.limit!==void 0&&(n.limit=t.limit),t.reverse===!0&&(n.reverse=!0)),n}_methodCall(){return this._isConnected()?Promise.resolve():new Promise((e,t)=>{let n=setTimeout(function(){t({code:f.timeout,message:"timeout"})},this._config.timeout);this._promises[this._nextPromiseId()]={timeout:n,resolve:e,reject:t}})}_callPromise(e,t){return new Promise((n,s)=>{this._call(e).then(r=>{n(t(r.reply)),r.next&&r.next()},r=>{s(r.error),r.next&&r.next()})})}_dataReceived(e){this._serverPing>0&&this._waitServerPing();let t=this._decoder.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then(()=>{let n;this._dispatchPromise=new Promise(s=>{n=s}),this._dispatchSynchronized(t,n)})}_dispatchSynchronized(e,t){let n=Promise.resolve();for(let s in e)e.hasOwnProperty(s)&&(n=n.then(()=>this._dispatchReply(e[s])));n=n.then(()=>{t()})}_dispatchReply(e){var t;let n=new Promise(r=>{t=r});if(e==null)return this._debug("dispatch: got undefined or null reply"),t(),n;let s=e.id;return s&&s>0?this._handleReply(e,t):e.push?this._handlePush(e.push,t):this._handleServerPing(t),n}_call(e){return new Promise((t,n)=>{e.id=this._nextCommandId(),this._registerCall(e.id,t,n),this._addCommand(e)})}_callConnectFake(e){return new Promise((t,n)=>{this._registerCall(e,t,n)})}_startConnecting(){this._debug("start connecting"),this._setState("connecting")&&this.emit("connecting",{code:S.connectCalled,reason:"connect called"}),this._client=null,this._initializeTransport()}_disconnect(e,t,n){if(this._isDisconnected())return;let s=this.state,r={code:e,reason:t},c=!1;n?c=this._setState("connecting"):(c=this._setState("disconnected"),this._rejectPromises({code:f.clientDisconnected,message:"disconnected"})),this._clearOutgoingRequests(),s==="connecting"&&this._clearReconnectTimeout(),s==="connected"&&this._clearConnectedState(),c&&(this._isConnecting()?this.emit("connecting",r):this.emit("disconnected",r)),this._transport&&!this._transportClosed&&(this._transportClosed=!0,this._transport.close())}_failUnauthorized(){this._disconnect(R.unauthorized,"unauthorized",!1)}_getToken(){if(this._debug("get connection token"),!this._config.getToken)throw new Error("provide a function to get connection token");return this._config.getToken({})}_refresh(){let e=this._client,t=this;this._getToken().then(function(n){if(e!==t._client)return;if(!n){t._failUnauthorized();return}if(t._token=n,t._debug("connection token refreshed"),!t._isConnected())return;let s={refresh:{token:t._token}};t._call(s).then(r=>{let c=r.reply.refresh;t._refreshResponse(c),r.next&&r.next()},r=>{t._refreshError(r.error),r.next&&r.next()})}).catch(function(n){t.emit("error",{type:"refreshToken",error:{code:f.clientRefreshToken,message:n!==void 0?n.toString():""}}),t._refreshTimeout=setTimeout(()=>t._refresh(),t._getRefreshRetryDelay())})}_refreshError(e){e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._disconnect(e.code,e.message,!1)}_getRefreshRetryDelay(){return x(0,5e3,1e4)}_refreshResponse(e){this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._client=e.client,this._refreshTimeout=setTimeout(()=>this._refresh(),C(e.ttl)))}_subscribe(e){this._debug("subscribing on",e.channel);let t=e.channel;if(t in this._subs||(this._subs[t]=e),!this._isConnected()){this._debug("delay subscribe on",e.channel,"till connected");return}if(e._usesToken()){let n=this._client,s=this;e._token?this._sendSubscribe(e,e._token):e._getSubscriptionToken().then(function(r){if(n===s._client&&!!e._isSubscribing()){if(!r){e._failUnauthorized();return}e._token=r,s._sendSubscribe(e,r)}}).catch(function(r){!e._isSubscribing()||(e.emit("error",{type:"subscribeToken",channel:e.channel,error:{code:f.subscriptionSubscribeToken,message:r!==void 0?r.toString():""}}),e._scheduleResubscribe())})}else this._sendSubscribe(e,"")}_sendSubscribe(e,t){let n=e.channel,s={channel:n};if(t&&(s.token=t),e._data&&(s.data=e._data),e._positioned&&(s.positioned=!0),e._recoverable&&(s.recoverable=!0),e._needRecover()){s.recover=!0;let c=e._getOffset();c&&(s.offset=c);let a=e._getEpoch();a&&(s.epoch=a)}let r={subscribe:s};this._call(r).then(c=>{let a=c.reply.subscribe;this._subscribeResponse(n,a),c.next&&c.next()},c=>{this._subscribeError(n,c.error),c.next&&c.next()})}_sendSubRefresh(e,t){let s={sub_refresh:{channel:e.channel,token:t}};this._call(s).then(r=>{let c=r.reply.sub_refresh;e._refreshResponse(c),r.next&&r.next()},r=>{e._refreshError(r.error),r.next&&r.next()})}_removeSubscription(e){e!==null&&delete this._subs[e.channel]}_unsubscribe(e){if(!this._isConnected())return;let n={unsubscribe:{channel:e.channel}},s=this;this._call(n).then(r=>{r.next&&r.next()},r=>{r.next&&r.next(),s._disconnect(S.unsubscribeError,"unsubscribe error",!0)})}_getSub(e){let t=this._subs[e];return t||null}_isServerSub(e){return this._serverSubs[e]!==void 0}_connectResponse(e){if(this._transportWasOpen=!0,this._reconnectAttempts=0,this._refreshRequired=!1,this._isConnected())return;this._client=e.client,this._setState("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(()=>this._refresh(),C(e.ttl))),this._session=e.session,this._node=e.node,this.startBatching();for(let n in this._subs)if(this._subs.hasOwnProperty(n)){let s=this._subs[n];s._isSubscribing()&&this._subscribe(s)}this.stopBatching();let t={client:e.client,transport:this._transport.subName()};e.data&&(t.data=e.data),this.emit("connected",t),this._resolvePromises(),this._processServerSubs(e.subs||{}),e.ping&&e.ping>0?(this._serverPing=e.ping*1e3,this._sendPong=e.pong===!0,this._waitServerPing()):this._serverPing=0}_processServerSubs(e){for(let t in e){if(!e.hasOwnProperty(t))continue;let n=e[t];this._serverSubs[t]={offset:n.offset,epoch:n.epoch,recoverable:n.recoverable||!1};let s=this._getSubscribeContext(t,n);this.emit("subscribed",s)}for(let t in e){if(!e.hasOwnProperty(t))continue;let n=e[t];if(n.recovered){let s=n.publications;if(s&&s.length>0)for(let r in s)s.hasOwnProperty(r)&&this._handlePublication(t,s[r])}}for(let t in this._serverSubs)!this._serverSubs.hasOwnProperty(t)||e[t]||(this.emit("unsubscribed",{channel:t}),delete this._serverSubs[t])}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearReconnectTimeout(){this._reconnectTimeout!==null&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null)}_clearServerPingTimeout(){this._serverPingTimeout!==null&&(clearTimeout(this._serverPingTimeout),this._serverPingTimeout=null)}_waitServerPing(){this._config.maxServerPingDelay!==0&&(!this._isConnected()||(this._clearServerPingTimeout(),this._serverPingTimeout=setTimeout(()=>{!this._isConnected()||this._disconnect(S.noPing,"no ping",!0)},this._serverPing+this._config.maxServerPingDelay)))}_subscribeError(e,t){let n=this._getSub(e);if(!!n&&!!n._isSubscribing()){if(t.code===f.timeout){this._disconnect(S.subscribeTimeout,"subscribe timeout",!0);return}n._subscribeError(t)}}_getSubscribeContext(e,t){let n={channel:e,positioned:!1,recoverable:!1,wasRecovering:!1,recovered:!1};t.recovered&&(n.recovered=!0),t.positioned&&(n.positioned=!0),t.recoverable&&(n.recoverable=!0),t.was_recovering&&(n.wasRecovering=!0);let s="";"epoch"in t&&(s=t.epoch);let r=0;return"offset"in t&&(r=t.offset),(n.positioned||n.recoverable)&&(n.streamPosition={offset:r,epoch:s}),t.data&&(n.data=t.data),n}_subscribeResponse(e,t){let n=this._getSub(e);!n||!n._isSubscribing()||n._setSubscribed(t)}_handleReply(e,t){let n=e.id;if(!(n in this._callbacks)){t();return}let s=this._callbacks[n];if(clearTimeout(this._callbacks[n].timeout),delete this._callbacks[n],oe(e)){let r=s.errback;if(!r){t();return}let c=e.error;r({error:c,next:t})}else{let r=s.callback;if(!r)return;r({reply:e,next:t})}}_handleJoin(e,t){let n=this._getSub(e);if(!n){if(this._isServerSub(e)){let s={channel:e,info:this._getJoinLeaveContext(t.info)};this.emit("join",s)}return}n._handleJoin(t)}_handleLeave(e,t){let n=this._getSub(e);if(!n){if(this._isServerSub(e)){let s={channel:e,info:this._getJoinLeaveContext(t.info)};this.emit("leave",s)}return}n._handleLeave(t)}_handleUnsubscribe(e,t){let n=this._getSub(e);if(!n){this._isServerSub(e)&&(delete this._serverSubs[e],this.emit("unsubscribed",{channel:e}));return}t.code<2500?n._setUnsubscribed(t.code,t.reason,!1):n._setSubscribing(t.code,t.reason)}_handleSubscribe(e,t){this._serverSubs[e]={offset:t.offset,epoch:t.epoch,recoverable:t.recoverable||!1},this.emit("subscribed",this._getSubscribeContext(e,t))}_handleDisconnect(e){let t=e.code,n=!0;(t>=3500&&t<4e3||t>=4500&&t<5e3)&&(n=!1),this._disconnect(t,e.reason,n)}_getPublicationContext(e,t){let n={channel:e,data:t.data};return t.offset&&(n.offset=t.offset),t.info&&(n.info=this._getJoinLeaveContext(t.info)),t.tags&&(n.tags=t.tags),n}_getJoinLeaveContext(e){let t={client:e.client,user:e.user};return e.conn_info&&(t.connInfo=e.conn_info),e.chan_info&&(t.chanInfo=e.chan_info),t}_handlePublication(e,t){let n=this._getSub(e);if(!n){if(this._isServerSub(e)){let s=this._getPublicationContext(e,t);this.emit("publication",s),t.offset!==void 0&&(this._serverSubs[e].offset=t.offset)}return}n._handlePublication(t)}_handleMessage(e){this.emit("message",{data:e.data})}_handleServerPing(e){if(this._sendPong){let t={};this._transportSendCommands([t])}e()}_handlePush(e,t){let n=e.channel;e.pub?this._handlePublication(n,e.pub):e.message?this._handleMessage(e.message):e.join?this._handleJoin(n,e.join):e.leave?this._handleLeave(n,e.leave):e.unsubscribe?this._handleUnsubscribe(n,e.unsubscribe):e.subscribe?this._handleSubscribe(n,e.subscribe):e.disconnect&&this._handleDisconnect(e.disconnect),t()}_flush(){let e=this._commands.slice(0);this._commands=[],this._transportSendCommands(e)}_createErrorObject(e,t,n){let s={code:e,message:t};return n&&(s.temporary=!0),s}_registerCall(e,t,n){this._callbacks[e]={callback:t,errback:n,timeout:null},this._callbacks[e].timeout=setTimeout(()=>{delete this._callbacks[e],F(n)&&n({error:this._createErrorObject(f.timeout,"timeout")})},this._config.timeout)}_addCommand(e){this._batching?this._commands.push(e):this._transportSendCommands([e])}_nextPromiseId(){return++this._promiseId}_resolvePromises(){for(let e in this._promises)this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e]}_rejectPromises(e){for(let t in this._promises)this._promises[t].timeout&&clearTimeout(this._promises[t].timeout),this._promises[t].reject(e),delete this._promises[t]}};E.SubscriptionState=L;E.State=W;window.Centrifuge=E;})();
//# sourceMappingURL=centrifuge.js.map
