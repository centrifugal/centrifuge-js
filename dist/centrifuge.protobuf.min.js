!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Centrifuge",[],t):"object"==typeof exports?exports.Centrifuge=t():e.Centrifuge=t()}(this,(function(){return function(){"use strict";var __webpack_modules__={537:function(e){e.exports=function(e,t){for(var s=new Array(arguments.length-1),r=0,i=2,n=!0;i<arguments.length;)s[r++]=arguments[i++];return new Promise((function(i,o){s[r]=function(e){if(n)if(n=!1,e)o(e);else{for(var t=new Array(arguments.length-1),s=0;s<t.length;)t[s++]=arguments[s];i.apply(null,t)}};try{e.apply(t||null,s)}catch(e){n&&(n=!1,o(e))}}))}},419:function(e,t){var s=t;s.length=function(e){var t=e.length;if(!t)return 0;for(var s=0;--t%4>1&&"="===e.charAt(t);)++s;return Math.ceil(3*e.length)/4-s};for(var r=new Array(64),i=new Array(123),n=0;n<64;)i[r[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;s.encode=function(e,t,s){for(var i,n=null,o=[],a=0,h=0;t<s;){var u=e[t++];switch(h){case 0:o[a++]=r[u>>2],i=(3&u)<<4,h=1;break;case 1:o[a++]=r[i|u>>4],i=(15&u)<<2,h=2;break;case 2:o[a++]=r[i|u>>6],o[a++]=r[63&u],h=0}a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),a=0)}return h&&(o[a++]=r[i],o[a++]=61,1===h&&(o[a++]=61)),n?(a&&n.push(String.fromCharCode.apply(String,o.slice(0,a))),n.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var o="invalid encoding";s.decode=function(e,t,s){for(var r,n=s,a=0,h=0;h<e.length;){var u=e.charCodeAt(h++);if(61===u&&a>1)break;if(void 0===(u=i[u]))throw Error(o);switch(a){case 0:r=u,a=1;break;case 1:t[s++]=r<<2|(48&u)>>4,r=u,a=2;break;case 2:t[s++]=(15&r)<<4|(60&u)>>2,r=u,a=3;break;case 3:t[s++]=(3&r)<<6|u,a=0}}if(1===a)throw Error(o);return s-n},s.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},124:function(e){function t(e,s){"string"==typeof e&&(s=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var s=n();if(t.verbose&&console.log("codegen: "+s),s="return "+s,e){for(var o=Object.keys(e),a=new Array(o.length+1),h=new Array(o.length),u=0;u<o.length;)a[u]=o[u],h[u]=e[o[u++]];return a[u]=s,Function.apply(null,a).apply(null,h)}return Function(s)()}for(var c=new Array(arguments.length-1),l=0;l<c.length;)c[l]=arguments[++l];if(l=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var s=c[l++];switch(t){case"d":case"f":return String(Number(s));case"i":return String(Math.floor(s));case"j":return JSON.stringify(s);case"s":return String(s)}return"%"})),l!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function n(t){return"function "+(t||s||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=n,i}e.exports=t,t.verbose=!1},211:function(e){function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,s){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:s||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var s=this._listeners[e],r=0;r<s.length;)s[r].fn===t?s.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var s=[],r=1;r<arguments.length;)s.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,s)}return this}},154:function(e,t,s){e.exports=n;var r=s(537),i=s(199)("fs");function n(e,t,s){return"function"==typeof t?(s=t,t={}):t||(t={}),s?!t.xhr&&i&&i.readFile?i.readFile(e,(function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?n.xhr(e,t,s):r?s(r):s(null,t.binary?i:i.toString("utf8"))})):n.xhr(e,t,s):r(n,this,e,t)}n.xhr=function(e,t,s){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return s(Error("status "+r.status));if(t.binary){var e=r.response;if(!e){e=[];for(var i=0;i<r.responseText.length;++i)e.push(255&r.responseText.charCodeAt(i))}return s(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return s(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}},945:function(e){function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),s=new Uint8Array(t.buffer),r=128===s[3];function i(e,r,i){t[0]=e,r[i]=s[0],r[i+1]=s[1],r[i+2]=s[2],r[i+3]=s[3]}function n(e,r,i){t[0]=e,r[i]=s[3],r[i+1]=s[2],r[i+2]=s[1],r[i+3]=s[0]}function o(e,r){return s[0]=e[r],s[1]=e[r+1],s[2]=e[r+2],s[3]=e[r+3],t[0]}function a(e,r){return s[3]=e[r],s[2]=e[r+1],s[1]=e[r+2],s[0]=e[r+3],t[0]}e.writeFloatLE=r?i:n,e.writeFloatBE=r?n:i,e.readFloatLE=r?o:a,e.readFloatBE=r?a:o}():function(){function t(e,t,s,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,s,r);else if(isNaN(t))e(2143289344,s,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,s,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,s,r);else{var n=Math.floor(Math.log(t)/Math.LN2);e((i<<31|n+127<<23|8388607&Math.round(t*Math.pow(2,-n)*8388608))>>>0,s,r)}}function o(e,t,s){var r=e(t,s),i=2*(r>>31)+1,n=r>>>23&255,o=8388607&r;return 255===n?o?NaN:i*(1/0):0===n?1401298464324817e-60*i*o:i*Math.pow(2,n-150)*(o+8388608)}e.writeFloatLE=t.bind(null,s),e.writeFloatBE=t.bind(null,r),e.readFloatLE=o.bind(null,i),e.readFloatBE=o.bind(null,n)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),s=new Uint8Array(t.buffer),r=128===s[7];function i(e,r,i){t[0]=e,r[i]=s[0],r[i+1]=s[1],r[i+2]=s[2],r[i+3]=s[3],r[i+4]=s[4],r[i+5]=s[5],r[i+6]=s[6],r[i+7]=s[7]}function n(e,r,i){t[0]=e,r[i]=s[7],r[i+1]=s[6],r[i+2]=s[5],r[i+3]=s[4],r[i+4]=s[3],r[i+5]=s[2],r[i+6]=s[1],r[i+7]=s[0]}function o(e,r){return s[0]=e[r],s[1]=e[r+1],s[2]=e[r+2],s[3]=e[r+3],s[4]=e[r+4],s[5]=e[r+5],s[6]=e[r+6],s[7]=e[r+7],t[0]}function a(e,r){return s[7]=e[r],s[6]=e[r+1],s[5]=e[r+2],s[4]=e[r+3],s[3]=e[r+4],s[2]=e[r+5],s[1]=e[r+6],s[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:n,e.writeDoubleBE=r?n:i,e.readDoubleLE=r?o:a,e.readDoubleBE=r?a:o}():function(){function t(e,t,s,r,i,n){var o=r<0?1:0;if(o&&(r=-r),0===r)e(0,i,n+t),e(1/r>0?0:2147483648,i,n+s);else if(isNaN(r))e(0,i,n+t),e(2146959360,i,n+s);else if(r>17976931348623157e292)e(0,i,n+t),e((o<<31|2146435072)>>>0,i,n+s);else{var a;if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,i,n+t),e((o<<31|a/4294967296)>>>0,i,n+s);else{var h=Math.floor(Math.log(r)/Math.LN2);1024===h&&(h=1023),e(4503599627370496*(a=r*Math.pow(2,-h))>>>0,i,n+t),e((o<<31|h+1023<<20|1048576*a&1048575)>>>0,i,n+s)}}}function o(e,t,s,r,i){var n=e(r,i+t),o=e(r,i+s),a=2*(o>>31)+1,h=o>>>20&2047,u=4294967296*(1048575&o)+n;return 2047===h?u?NaN:a*(1/0):0===h?5e-324*a*u:a*Math.pow(2,h-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,s,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=o.bind(null,i,0,4),e.readDoubleBE=o.bind(null,n,4,0)}(),e}function s(e,t,s){t[s]=255&e,t[s+1]=e>>>8&255,t[s+2]=e>>>16&255,t[s+3]=e>>>24}function r(e,t,s){t[s]=e>>>24,t[s+1]=e>>>16&255,t[s+2]=e>>>8&255,t[s+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function n(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},199:function(module){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},626:function(e,t){var s=t,r=s.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=s.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),s=r(e),i="";s&&(i=t.shift()+"/");for(var n=0;n<t.length;)".."===t[n]?n>0&&".."!==t[n-1]?t.splice(--n,2):s?t.splice(n,1):++n:"."===t[n]?t.splice(n,1):++n;return i+t.join("/")};s.resolve=function(e,t,s){return s||(t=i(t)),r(t)?t:(s||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},662:function(e){e.exports=function(e,t,s){var r=s||8192,i=r>>>1,n=null,o=r;return function(s){if(s<1||s>i)return e(s);o+s>r&&(n=e(r),o=0);var a=t.call(n,o,o+=s);return 7&o&&(o=1+(7|o)),a}}},997:function(e,t){var s=t;s.length=function(e){for(var t=0,s=0,r=0;r<e.length;++r)(s=e.charCodeAt(r))<128?t+=1:s<2048?t+=2:55296==(64512&s)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},s.read=function(e,t,s){if(s-t<1)return"";for(var r,i=null,n=[],o=0;t<s;)(r=e[t++])<128?n[o++]=r:r>191&&r<224?n[o++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,n[o++]=55296+(r>>10),n[o++]=56320+(1023&r)):n[o++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,n)),o=0);return i?(o&&i.push(String.fromCharCode.apply(String,n.slice(0,o))),i.join("")):String.fromCharCode.apply(String,n.slice(0,o))},s.write=function(e,t,s){for(var r,i,n=s,o=0;o<e.length;++o)(r=e.charCodeAt(o))<128?t[s++]=r:r<2048?(t[s++]=r>>6|192,t[s++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(o+1)))?(r=65536+((1023&r)<<10)+(1023&i),++o,t[s++]=r>>18|240,t[s++]=r>>12&63|128,t[s++]=r>>6&63|128,t[s++]=63&r|128):(t[s++]=r>>12|224,t[s++]=r>>6&63|128,t[s++]=63&r|128);return s-n}},187:function(e){var t,s="object"==typeof Reflect?Reflect:null,r=s&&"function"==typeof s.apply?s.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};t=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}e.exports=n,e.exports.once=function(e,t){return new Promise((function(s,r){function i(){void 0!==n&&e.removeListener("error",n),s([].slice.call(arguments))}var n;"error"!==t&&(n=function(s){e.removeListener(t,i),r(s)},e.once("error",n)),e.once(t,i)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function u(e,t,s,r){var i,n,o,u;if(a(s),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),n=e._events),o=n[t]),void 0===o)o=n[t]=s,++e._eventsCount;else if("function"==typeof o?o=n[t]=r?[s,o]:[o,s]:r?o.unshift(s):o.push(s),(i=h(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,u=c,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,s){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},i=c.bind(r);return i.listener=s,r.wrapFn=i,i}function f(e,t,s){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?s?[i.listener||i]:[i]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(i):d(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function d(e,t){for(var s=new Array(t),r=0;r<t;++r)s[r]=e[r];return s}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return h(this)},n.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=n[e];if(void 0===h)return!1;if("function"==typeof h)r(h,this,t);else{var u=h.length,c=d(h,u);for(s=0;s<u;++s)r(c[s],this,t)}return!0},n.prototype.addListener=function(e,t){return u(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return u(this,e,t,!0)},n.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},n.prototype.removeListener=function(e,t){var s,r,i,n,o;if(a(t),void 0===(r=this._events))return this;if(void 0===(s=r[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(i=-1,n=s.length-1;n>=0;n--)if(s[n]===t||s[n].listener===t){o=s[n].listener,i=n;break}if(i<0)return this;0===i?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,i),1===s.length&&(r[e]=s[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,s,r;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var i,n=Object.keys(s);for(r=0;r<n.length;++r)"removeListener"!==(i=n[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},n.prototype.listeners=function(e){return f(this,e,!0)},n.prototype.rawListeners=function(e){return f(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},n.prototype.listenerCount=p,n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},492:function(e,t,s){e.exports=s(836)},996:function(e,t,s){var r=t,i=s(25),n=s(935);function o(e,t,s,r){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var n=t.resolvedType.values,o=Object.keys(n),a=0;a<o.length;++a)t.repeated&&n[o[a]]===t.typeDefault&&e("default:"),e("case%j:",o[a])("case %i:",n[o[a]])("m%s=%j",r,n[o[a]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,s,r);else{var h=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":h=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,h)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,h?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function a(e,t,s,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,s,r,r):e("d%s=types[%i].toObject(m%s,o)",r,s,r);else{var n=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":n=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,n?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,s=n.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return s("return new this.ctor");s("var m=new this.ctor");for(var r=0;r<t.length;++r){var a=t[r].resolve(),h=n.safeProp(a.name);a.map?(s("if(d%s){",h)('if(typeof d%s!=="object")',h)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",h)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",h),o(s,a,r,h+"[ks[i]]")("}")("}")):a.repeated?(s("if(d%s){",h)("if(!Array.isArray(d%s))",h)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",h)("for(var i=0;i<d%s.length;++i){",h),o(s,a,r,h+"[i]")("}")("}")):(a.resolvedType instanceof i||s("if(d%s!=null){",h),o(s,a,r,h),a.resolvedType instanceof i||s("}"))}return s("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(n.compareFieldsById);if(!t.length)return n.codegen()("return {}");for(var s=n.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],o=[],h=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?o:h).push(t[u]);if(r.length){for(s("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)s("d%s=[]",n.safeProp(r[u].name));s("}")}if(o.length){for(s("if(o.objects||o.defaults){"),u=0;u<o.length;++u)s("d%s={}",n.safeProp(o[u].name));s("}")}if(h.length){for(s("if(o.defaults){"),u=0;u<h.length;++u){var c=h[u],l=n.safeProp(c.name);if(c.resolvedType instanceof i)s("d%s=o.enums===String?%j:%j",l,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)s("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var f="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";s("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",l,f)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else s("d%s=%j",l,c.typeDefault)}s("}")}var p=!1;for(u=0;u<t.length;++u){c=t[u];var d=e._fieldsArray.indexOf(c);l=n.safeProp(c.name),c.map?(p||(p=!0,s("var ks2")),s("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),a(s,c,d,l+"[ks2[j]]")("}")):c.repeated?(s("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),a(s,c,d,l+"[j]")("}")):(s("if(m%s!=null&&m.hasOwnProperty(%j)){",l,c.name),a(s,c,d,l),c.partOf&&s("if(o.oneofs)")("d%s=%j",n.safeProp(c.partOf.name),c.name)),s("}")}return s("return d")}},305:function(e,t,s){e.exports=function(e){var t=n.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var s=0;s<e.fieldsArray.length;++s){var a=e._fieldsArray[s].resolve(),h=a.resolvedType instanceof r?"int32":a.type,u="m"+n.safeProp(a.name);t("case %i:",a.id),a.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[a.keyType]?t("k=%j",i.defaults[a.keyType]):t("k=null"),void 0!==i.defaults[h]?t("value=%j",i.defaults[h]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",a.keyType)("case 2:"),void 0===i.basic[h]?t("value=types[%i].decode(r,r.uint32())",s):t("value=r.%s()",h),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[a.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',u):t("%s[k]=value",u)):a.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[h]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,h)("}else"),void 0===i.basic[h]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,s):t("%s.push(r.%s())",u,h)):void 0===i.basic[h]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,s):t("%s=r.%s()",u,h),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),s=0;s<e._fieldsArray.length;++s){var c=e._fieldsArray[s];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",o(c))}return t("return m")};var r=s(25),i=s(63),n=s(935);function o(e){return"missing required '"+e.name+"'"}},928:function(e,t,s){e.exports=function(e){for(var t,s=n.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),a=e.fieldsArray.slice().sort(n.compareFieldsById),h=0;h<a.length;++h){var u=a[h].resolve(),c=e._fieldsArray.indexOf(u),l=u.resolvedType instanceof r?"int32":u.type,f=i.basic[l];t="m"+n.safeProp(u.name),u.map?(s("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===f?s("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,t):s(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|f,l,t),s("}")("}")):u.repeated?(s("if(%s!=null&&%s.length){",t,t),u.packed&&void 0!==i.packed[l]?s("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",l,t)("w.ldelim()"):(s("for(var i=0;i<%s.length;++i)",t),void 0===f?o(s,u,c,t+"[i]"):s("w.uint32(%i).%s(%s[i])",(u.id<<3|f)>>>0,l,t)),s("}")):(u.optional&&s("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,u.name),void 0===f?o(s,u,c,t):s("w.uint32(%i).%s(%s)",(u.id<<3|f)>>>0,l,t))}return s("return w")};var r=s(25),i=s(63),n=s(935);function o(e,t,s,r){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",s,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",s,r,(t.id<<3|2)>>>0)}},25:function(e,t,s){e.exports=o;var r=s(243);((o.prototype=Object.create(r.prototype)).constructor=o).className="Enum";var i=s(313),n=s(935);function o(e,t,s,i,n){if(r.call(this,e,s),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=n||{},this.reserved=void 0,t)for(var o=Object.keys(t),a=0;a<o.length;++a)"number"==typeof t[o[a]]&&(this.valuesById[this.values[o[a]]=t[o[a]]]=o[a])}o.fromJSON=function(e,t){var s=new o(e,t.values,t.options,t.comment,t.comments);return s.reserved=t.reserved,s},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return n.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},o.prototype.add=function(e,t,s){if(!n.isString(e))throw TypeError("name must be a string");if(!n.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=s||null,this},o.prototype.remove=function(e){if(!n.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},o.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},o.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},548:function(e,t,s){e.exports=u;var r=s(243);((u.prototype=Object.create(r.prototype)).constructor=u).className="Field";var i,n=s(25),o=s(63),a=s(935),h=/^required|optional|repeated$/;function u(e,t,s,i,n,u,c){if(a.isObject(i)?(c=n,u=i,i=n=void 0):a.isObject(n)&&(c=u,u=n,n=void 0),r.call(this,e,u),!a.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!a.isString(s))throw TypeError("type must be a string");if(void 0!==i&&!h.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==n&&!a.isString(n))throw TypeError("extend must be a string");this.rule=i&&"optional"!==i?i:void 0,this.type=s,this.id=t,this.extend=n||void 0,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&void 0!==o.long[s],this.bytes="bytes"===s,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=c}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,s){return"packed"===e&&(this._packed=null),r.prototype.setOption.call(this,e,t,s)},u.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return a.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=o.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof n&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof n)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,e=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,e=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),r.prototype.resolve.call(this)},u.d=function(e,t,s,r){return"function"==typeof t?t=a.decorateType(t).name:t&&"object"==typeof t&&(t=a.decorateEnum(t).name),function(i,n){a.decorateType(i.constructor).add(new u(n,e,t,s,{default:r}))}},u._configure=function(e){i=e}},836:function(e,t,s){var r=e.exports=s(482);r.build="light",r.load=function(e,t,s){return"function"==typeof t?(s=t,t=new r.Root):t||(t=new r.Root),t.load(e,s)},r.loadSync=function(e,t){return t||(t=new r.Root),t.loadSync(e)},r.encoder=s(928),r.decoder=s(305),r.verifier=s(497),r.converter=s(996),r.ReflectionObject=s(243),r.Namespace=s(313),r.Root=s(424),r.Enum=s(25),r.Type=s(645),r.Field=s(548),r.OneOf=s(598),r.MapField=s(39),r.Service=s(513),r.Method=s(429),r.Message=s(368),r.wrappers=s(667),r.types=s(63),r.util=s(935),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},482:function(e,t,s){var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=s(173),r.BufferWriter=s(155),r.Reader=s(408),r.BufferReader=s(593),r.util=s(693),r.rpc=s(994),r.roots=s(54),r.configure=i,i()},39:function(e,t,s){e.exports=o;var r=s(548);((o.prototype=Object.create(r.prototype)).constructor=o).className="MapField";var i=s(63),n=s(935);function o(e,t,s,i,o,a){if(r.call(this,e,t,i,void 0,void 0,o,a),!n.isString(s))throw TypeError("keyType must be a string");this.keyType=s,this.resolvedKeyType=null,this.map=!0}o.fromJSON=function(e,t){return new o(e,t.id,t.keyType,t.type,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return n.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},o.d=function(e,t,s){return"function"==typeof s?s=n.decorateType(s).name:s&&"object"==typeof s&&(s=n.decorateEnum(s).name),function(r,i){n.decorateType(r.constructor).add(new o(i,e,t,s))}}},368:function(e,t,s){e.exports=i;var r=s(693);function i(e){if(e)for(var t=Object.keys(e),s=0;s<t.length;++s)this[t[s]]=e[t[s]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},429:function(e,t,s){e.exports=n;var r=s(243);((n.prototype=Object.create(r.prototype)).constructor=n).className="Method";var i=s(935);function n(e,t,s,n,o,a,h,u,c){if(i.isObject(o)?(h=o,o=a=void 0):i.isObject(a)&&(h=a,a=void 0),void 0!==t&&!i.isString(t))throw TypeError("type must be a string");if(!i.isString(s))throw TypeError("requestType must be a string");if(!i.isString(n))throw TypeError("responseType must be a string");r.call(this,e,h),this.type=t||"rpc",this.requestType=s,this.requestStream=!!o||void 0,this.responseType=n,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}n.fromJSON=function(e,t){return new n(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},n.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},n.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},313:function(e,t,s){e.exports=c;var r=s(243);((c.prototype=Object.create(r.prototype)).constructor=c).className="Namespace";var i,n,o,a=s(548),h=s(935);function u(e,t){if(e&&e.length){for(var s={},r=0;r<e.length;++r)s[e[r].name]=e[r].toJSON(t);return s}}function c(e,t){r.call(this,e,t),this.nested=void 0,this._nestedArray=null}function l(e){return e._nestedArray=null,e}c.fromJSON=function(e,t){return new c(e,t.options).addJSON(t.nested)},c.arrayToJSON=u,c.isReservedId=function(e,t){if(e)for(var s=0;s<e.length;++s)if("string"!=typeof e[s]&&e[s][0]<=t&&e[s][1]>t)return!0;return!1},c.isReservedName=function(e,t){if(e)for(var s=0;s<e.length;++s)if(e[s]===t)return!0;return!1},Object.defineProperty(c.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=h.toArray(this.nested))}}),c.prototype.toJSON=function(e){return h.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},c.prototype.addJSON=function(e){if(e)for(var t,s=Object.keys(e),r=0;r<s.length;++r)t=e[s[r]],this.add((void 0!==t.fields?i.fromJSON:void 0!==t.values?o.fromJSON:void 0!==t.methods?n.fromJSON:void 0!==t.id?a.fromJSON:c.fromJSON)(s[r],t));return this},c.prototype.get=function(e){return this.nested&&this.nested[e]||null},c.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof o)return this.nested[e].values;throw Error("no such enum: "+e)},c.prototype.add=function(e){if(!(e instanceof a&&void 0!==e.extend||e instanceof i||e instanceof o||e instanceof n||e instanceof c))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof c&&e instanceof c)||t instanceof i||t instanceof n)throw Error("duplicate name '"+e.name+"' in "+this);for(var s=t.nestedArray,r=0;r<s.length;++r)e.add(s[r]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),l(this)},c.prototype.remove=function(e){if(!(e instanceof r))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),l(this)},c.prototype.define=function(e,t){if(h.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var s=this;e.length>0;){var r=e.shift();if(s.nested&&s.nested[r]){if(!((s=s.nested[r])instanceof c))throw Error("path conflicts with non-namespace objects")}else s.add(s=new c(r))}return t&&s.addJSON(t),s},c.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof c?e[t++].resolveAll():e[t++].resolve();return this.resolve()},c.prototype.lookup=function(e,t,s){if("boolean"==typeof t?(s=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),h.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof c&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof c&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||s?null:this.parent.lookup(e,t)},c.prototype.lookupType=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such type: "+e);return t},c.prototype.lookupEnum=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},c.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[i,o]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},c.prototype.lookupService=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},c._configure=function(e,t,s){i=e,n=t,o=s}},243:function(e,t,s){e.exports=n,n.className="ReflectionObject";var r,i=s(935);function n(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(n.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),n.prototype.toJSON=function(){throw Error()},n.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},n.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},n.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},n.prototype.getOption=function(e){if(this.options)return this.options[e]},n.prototype.setOption=function(e,t,s){return s&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},n.prototype.setParsedOption=function(e,t,s){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(s){var n=r.find((function(t){return Object.prototype.hasOwnProperty.call(t,e)}));if(n){var o=n[e];i.setProperty(o,s,t)}else(n={})[e]=i.setProperty({},s,t),r.push(n)}else{var a={};a[e]=t,r.push(a)}return this},n.prototype.setOptions=function(e,t){if(e)for(var s=Object.keys(e),r=0;r<s.length;++r)this.setOption(s[r],e[s[r]],t);return this},n.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},n._configure=function(e){r=e}},598:function(e,t,s){e.exports=o;var r=s(243);((o.prototype=Object.create(r.prototype)).constructor=o).className="OneOf";var i=s(548),n=s(935);function o(e,t,s,i){if(Array.isArray(t)||(s=t,t=void 0),r.call(this,e,s),void 0!==t&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function a(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}o.fromJSON=function(e,t){return new o(e,t.oneof,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return n.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},o.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,a(this),this},o.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},o.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var s=e.get(this.oneof[t]);s&&!s.partOf&&(s.partOf=this,this.fieldsArray.push(s))}a(this)},o.prototype.onRemove=function(e){for(var t,s=0;s<this.fieldsArray.length;++s)(t=this.fieldsArray[s]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},o.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,s){n.decorateType(t.constructor).add(new o(s,e)),Object.defineProperty(t,s,{get:n.oneOfGetter(e),set:n.oneOfSetter(e)})}}},408:function(e,t,s){e.exports=h;var r,i=s(693),n=i.LongBits,o=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function h(e){this.buf=e,this.pos=0,this.len=e.length}var u,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new h(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new h(e);throw Error("illegal buffer")},l=function(){return i.Buffer?function(e){return(h.create=function(e){return i.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c};function f(){var e=new n(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new n(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}h.create=l(),h.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,h.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),h.prototype.int32=function(){return 0|this.uint32()},h.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},h.prototype.bool=function(){return 0!==this.uint32()},h.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},h.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},h.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},h.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},h.prototype.bytes=function(){var e=this.uint32(),t=this.pos,s=this.pos+e;if(s>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,s):t===s?new this.buf.constructor(0):this._slice.call(this.buf,t,s)},h.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},h.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},h.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},h._configure=function(e){r=e,h.create=l(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(h.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},593:function(e,t,s){e.exports=n;var r=s(408);(n.prototype=Object.create(r.prototype)).constructor=n;var i=s(693);function n(e){r.call(this,e)}n._configure=function(){i.Buffer&&(n.prototype._slice=i.Buffer.prototype.slice)},n.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},n._configure()},424:function(e,t,s){e.exports=l;var r=s(313);((l.prototype=Object.create(r.prototype)).constructor=l).className="Root";var i,n,o,a=s(548),h=s(25),u=s(598),c=s(935);function l(e){r.call(this,"",e),this.deferred=[],this.files=[]}function f(){}l.fromJSON=function(e,t){return t||(t=new l),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},l.prototype.resolvePath=c.path.resolve,l.prototype.fetch=c.fetch,l.prototype.load=function e(t,s,r){"function"==typeof s&&(r=s,s=void 0);var i=this;if(!r)return c.asPromise(e,i,t,s);var a=r===f;function h(e,t){if(r){var s=r;if(r=null,a)throw e;s(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var s=e.substring(t);if(s in o)return s}return null}function l(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){n.filename=e;var r,o=n(t,i,s),l=0;if(o.imports)for(;l<o.imports.length;++l)(r=u(o.imports[l])||i.resolvePath(e,o.imports[l]))&&p(r);if(o.weakImports)for(l=0;l<o.weakImports.length;++l)(r=u(o.weakImports[l])||i.resolvePath(e,o.weakImports[l]))&&p(r,!0)}else i.setOptions(t.options).addJSON(t.nested)}catch(e){h(e)}a||d||h(null,i)}function p(e,t){if(!(i.files.indexOf(e)>-1))if(i.files.push(e),e in o)a?l(e,o[e]):(++d,setTimeout((function(){--d,l(e,o[e])})));else if(a){var s;try{s=c.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||h(e))}l(e,s)}else++d,i.fetch(e,(function(s,n){--d,r&&(s?t?d||h(null,i):h(s):l(e,n))}))}var d=0;c.isString(t)&&(t=[t]);for(var y,_=0;_<t.length;++_)(y=i.resolvePath("",t[_]))&&p(y);if(a)return i;d||h(null,i)},l.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,f)},l.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return r.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function d(e,t){var s=t.parent.lookup(t.extend);if(s){var r=new a(t.fullName,t.id,t.type,t.rule,void 0,t.options);return r.declaringField=t,t.extensionField=r,s.add(r),!0}return!1}l.prototype._handleAdd=function(e){if(e instanceof a)void 0===e.extend||e.extensionField||d(0,e)||this.deferred.push(e);else if(e instanceof h)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof i)for(var t=0;t<this.deferred.length;)d(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var s=0;s<e.nestedArray.length;++s)this._handleAdd(e._nestedArray[s]);p.test(e.name)&&(e.parent[e.name]=e)}},l.prototype._handleRemove=function(e){if(e instanceof a){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof h)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof r){for(var s=0;s<e.nestedArray.length;++s)this._handleRemove(e._nestedArray[s]);p.test(e.name)&&delete e.parent[e.name]}},l._configure=function(e,t,s){i=e,n=t,o=s}},54:function(e){e.exports={}},994:function(e,t,s){t.Service=s(948)},948:function(e,t,s){e.exports=i;var r=s(693);function i(e,t,s){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(s)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,s,i,n,o){if(!n)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,s,i,n);if(a.rpcImpl)try{return a.rpcImpl(t,s[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),(function(e,s){if(e)return a.emit("error",e,t),o(e);if(null!==s){if(!(s instanceof i))try{s=i[a.responseDelimited?"decodeDelimited":"decode"](s)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",s,t),o(null,s)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},513:function(e,t,s){e.exports=a;var r=s(313);((a.prototype=Object.create(r.prototype)).constructor=a).className="Service";var i=s(429),n=s(935),o=s(994);function a(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function h(e){return e._methodsArray=null,e}a.fromJSON=function(e,t){var s=new a(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),n=0;n<r.length;++n)s.add(i.fromJSON(r[n],t.methods[r[n]]));return t.nested&&s.addJSON(t.nested),s.comment=t.comment,s},a.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),s=!!e&&Boolean(e.keepComments);return n.toObject(["options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",s?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=n.toArray(this.methods))}}),a.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},a.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},a.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,h(this)):r.prototype.add.call(this,e)},a.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,h(this)}return r.prototype.remove.call(this,e)},a.prototype.create=function(e,t,s){for(var r,i=new o.Service(e,t,s),a=0;a<this.methodsArray.length;++a){var h=n.lcFirst((r=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");i[h]=n.codegen(["r","c"],n.isReserved(h)?h+"_":h)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},645:function(e,t,s){e.exports=b;var r=s(313);((b.prototype=Object.create(r.prototype)).constructor=b).className="Type";var i=s(25),n=s(598),o=s(548),a=s(39),h=s(513),u=s(368),c=s(408),l=s(173),f=s(935),p=s(928),d=s(305),y=s(497),_=s(996),m=s(667);function b(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function g(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(b.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var s=this.fields[e[t]],r=s.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=s}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=f.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=f.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=b.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,f.merge(e.prototype,t)),e.$type=e.prototype.$type=this,f.merge(e,u,!0),this._ctor=e;for(var s=0;s<this.fieldsArray.length;++s)this._fieldsArray[s].resolve();var r={};for(s=0;s<this.oneofsArray.length;++s)r[this._oneofsArray[s].resolve().name]={get:f.oneOfGetter(this._oneofsArray[s].oneof),set:f.oneOfSetter(this._oneofsArray[s].oneof)};s&&Object.defineProperties(e.prototype,r)}}}),b.generateConstructor=function(e){for(var t,s=f.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?s("this%s={}",f.safeProp(t.name)):t.repeated&&s("this%s=[]",f.safeProp(t.name));return s("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},b.fromJSON=function(e,t){var s=new b(e,t.options);s.extensions=t.extensions,s.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)s.add((void 0!==t.fields[u[c]].keyType?a.fromJSON:o.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)s.add(n.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var l=t.nested[u[c]];s.add((void 0!==l.id?o.fromJSON:void 0!==l.fields?b.fromJSON:void 0!==l.values?i.fromJSON:void 0!==l.methods?h.fromJSON:r.fromJSON)(u[c],l))}return t.extensions&&t.extensions.length&&(s.extensions=t.extensions),t.reserved&&t.reserved.length&&(s.reserved=t.reserved),t.group&&(s.group=!0),t.comment&&(s.comment=t.comment),s},b.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),s=!!e&&Boolean(e.keepComments);return f.toObject(["options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",s?this.comment:void 0])},b.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var s=this.oneofsArray;for(t=0;t<s.length;)s[t++].resolve();return r.prototype.resolveAll.call(this)},b.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},b.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof o&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),g(this)}return e instanceof n?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),g(this)):r.prototype.add.call(this,e)},b.prototype.remove=function(e){if(e instanceof o&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),g(this)}if(e instanceof n){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),g(this)}return r.prototype.remove.call(this,e)},b.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},b.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},b.prototype.create=function(e){return new this.ctor(e)},b.prototype.setup=function(){for(var e=this.fullName,t=[],s=0;s<this.fieldsArray.length;++s)t.push(this._fieldsArray[s].resolve().resolvedType);this.encode=p(this)({Writer:l,types:t,util:f}),this.decode=d(this)({Reader:c,types:t,util:f}),this.verify=y(this)({types:t,util:f}),this.fromObject=_.fromObject(this)({types:t,util:f}),this.toObject=_.toObject(this)({types:t,util:f});var r=m[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},b.prototype.encode=function(e,t){return this.setup().encode(e,t)},b.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},b.prototype.decode=function(e,t){return this.setup().decode(e,t)},b.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},b.prototype.verify=function(e){return this.setup().verify(e)},b.prototype.fromObject=function(e){return this.setup().fromObject(e)},b.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},b.d=function(e){return function(t){f.decorateType(t,e)}}},63:function(e,t,s){var r=t,i=s(935),n=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function o(e,t){var s=0,r={};for(t|=0;s<e.length;)r[n[s+t]]=e[s++];return r}r.basic=o([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=o([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=o([0,0,0,1,1],7),r.mapKey=o([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=o([1,5,0,0,0,5,5,0,0,0,1,1,0])},935:function(e,t,s){var r,i,n=e.exports=s(693),o=s(54);n.codegen=s(124),n.fetch=s(154),n.path=s(626),n.fs=n.inquire("fs"),n.toArray=function(e){if(e){for(var t=Object.keys(e),s=new Array(t.length),r=0;r<t.length;)s[r]=e[t[r++]];return s}return[]},n.toObject=function(e){for(var t={},s=0;s<e.length;){var r=e[s++],i=e[s++];void 0!==i&&(t[r]=i)}return t};var a=/\\/g,h=/"/g;n.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},n.safeProp=function(e){return!/^[$\w_]+$/.test(e)||n.isReserved(e)?'["'+e.replace(a,"\\\\").replace(h,'\\"')+'"]':"."+e},n.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;n.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},n.compareFieldsById=function(e,t){return e.id-t.id},n.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(n.decorateRoot.remove(e.$type),e.$type.name=t,n.decorateRoot.add(e.$type)),e.$type;r||(r=s(645));var i=new r(t||e.name);return n.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;n.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=s(25));var t=new i("Enum"+c++,e);return n.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},n.setProperty=function(e,t,s){if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,s,r){var i=s.shift();if(s.length>0)t[i]=e(t[i]||{},s,r);else{var n=t[i];n&&(r=[].concat(n).concat(r)),t[i]=r}return t}(e,t=t.split("."),s)},Object.defineProperty(n,"decorateRoot",{get:function(){return o.decorated||(o.decorated=new(s(424)))}})},630:function(e,t,s){e.exports=i;var r=s(693);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var n=i.zero=new i(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return n;var t=e<0;t&&(e=-e);var s=e>>>0,r=(e-s)/4294967296>>>0;return t&&(r=~r>>>0,s=~s>>>0,++s>4294967295&&(s=0,++r>4294967295&&(r=0))),new i(s,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):n},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,s=~this.hi>>>0;return t||(s=s+1>>>0),-(t+4294967296*s)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===o?n:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,s=this.hi>>>24;return 0===s?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:s<128?9:10}},693:function(e,t,s){var r=t;function i(e,t,s){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&s||(e[r[i]]=t[r[i]]);return e}function n(e){function t(e,s){if(!(this instanceof t))return new t(e,s);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),s&&i(this,s)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=s(537),r.base64=s(419),r.EventEmitter=s(211),r.float=s(945),r.inquire=s(199),r.utf8=s(997),r.pool=s(662),r.LongBits=s(630),r.isNode=Boolean(void 0!==s.g&&s.g&&s.g.process&&s.g.process.versions&&s.g.process.versions.node),r.global=r.isNode&&s.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var s=e[t];return!(null==s||!e.hasOwnProperty(t))&&("object"!=typeof s||(Array.isArray(s)?s.length:Object.keys(s).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var s=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(s.lo,s.hi,t):s.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=n,r.ProtocolError=n("ProtocolError"),r.oneOfGetter=function(e){for(var t={},s=0;s<e.length;++s)t[e[s]]=1;return function(){for(var e=Object.keys(this),s=e.length-1;s>-1;--s)if(1===t[e[s]]&&void 0!==this[e[s]]&&null!==this[e[s]])return e[s]}},r.oneOfSetter=function(e){return function(t){for(var s=0;s<e.length;++s)e[s]!==t&&delete this[e[s]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,s){return new e(t,s)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},497:function(e,t,s){e.exports=function(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),s={};e.oneofsArray.length&&t("var p={}");for(var r=0;r<e.fieldsArray.length;++r){var h=e._fieldsArray[r].resolve(),u="m"+i.safeProp(h.name);if(h.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,h.name),h.map)t("if(!util.isObject(%s))",u)("return%j",n(h,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),a(t,h,"k[i]"),o(t,h,r,u+"[k[i]]")("}");else if(h.repeated)t("if(!Array.isArray(%s))",u)("return%j",n(h,"array"))("for(var i=0;i<%s.length;++i){",u),o(t,h,r,u+"[i]")("}");else{if(h.partOf){var c=i.safeProp(h.partOf.name);1===s[h.partOf.name]&&t("if(p%s===1)",c)("return%j",h.partOf.name+": multiple values"),s[h.partOf.name]=1,t("p%s=1",c)}o(t,h,r,u)}h.optional&&t("}")}return t("return null")};var r=s(25),i=s(935);function n(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function o(e,t,s,i){if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",n(t,"enum value"));for(var o=Object.keys(t.resolvedType.values),a=0;a<o.length;++a)e("case %i:",t.resolvedType.values[o[a]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",s,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",n(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",n(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",n(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",n(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",n(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",n(t,"buffer"))}return e}function a(e,t,s){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",s)("return%j",n(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",s)("return%j",n(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",s)("return%j",n(t,"boolean key"))}return e}},667:function(e,t,s){var r=t,i=s(368);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),s=this.lookup(t);if(s){var r="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return-1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:s.encode(s.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var s="",r="";if(t&&t.json&&e.type_url&&e.value){r=e.type_url.substring(e.type_url.lastIndexOf("/")+1),s=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var n=this.lookup(r);n&&(e=n.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t);return""===s&&(s="type.googleapis.com/"),r=s+("."===e.$type.fullName[0]?e.$type.fullName.substr(1):e.$type.fullName),o["@type"]=r,o}return this.toObject(e,t)}}},173:function(e,t,s){e.exports=l;var r,i=s(693),n=i.LongBits,o=i.base64,a=i.utf8;function h(e,t,s){this.fn=e,this.len=t,this.next=void 0,this.val=s}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function l(){this.len=0,this.head=new h(u,0,0),this.tail=this.head,this.states=null}var f=function(){return i.Buffer?function(){return(l.create=function(){return new r})()}:function(){return new l}};function p(e,t,s){t[s]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,s){for(;e.hi;)t[s++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[s++]=127&e.lo|128,e.lo=e.lo>>>7;t[s++]=e.lo}function _(e,t,s){t[s]=255&e,t[s+1]=e>>>8&255,t[s+2]=e>>>16&255,t[s+3]=e>>>24}l.create=f(),l.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(l.alloc=i.pool(l.alloc,i.Array.prototype.subarray)),l.prototype._push=function(e,t,s){return this.tail=this.tail.next=new h(e,t,s),this.len+=t,this},d.prototype=Object.create(h.prototype),d.prototype.fn=function(e,t,s){for(;e>127;)t[s++]=127&e|128,e>>>=7;t[s]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(y,10,n.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=n.from(e);return this._push(y,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=n.from(e).zzEncode();return this._push(y,t.length(),t)},l.prototype.bool=function(e){return this._push(p,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(_,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=n.from(e);return this._push(_,4,t.lo)._push(_,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var m=i.Array.prototype.set?function(e,t,s){t.set(e,s)}:function(e,t,s){for(var r=0;r<e.length;++r)t[s+r]=e[r]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var s=l.alloc(t=o.length(e));o.decode(e,s,0),e=s}return this.uint32(t)._push(m,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},l.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new h(u,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new h(u,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,s=this.len;return this.reset().uint32(s),s&&(this.tail.next=e.next,this.tail=t,this.len+=s),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),s=0;e;)e.fn(e.val,t,s),s+=e.len,e=e.next;return t},l._configure=function(e){r=e,l.create=f(),r._configure()}},155:function(e,t,s){e.exports=n;var r=s(173);(n.prototype=Object.create(r.prototype)).constructor=n;var i=s(693);function n(){r.call(this)}function o(e,t,s){e.length<40?i.utf8.write(e,t,s):t.utf8Write?t.utf8Write(e,s):t.write(e,s)}n._configure=function(){n.alloc=i._Buffer_allocUnsafe,n.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,s){t.set(e,s)}:function(e,t,s){if(e.copy)e.copy(t,s,0,e.length);else for(var r=0;r<e.length;)t[s++]=e[r++]}},n.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(n.writeBytesBuffer,t,e),this},n.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},n._configure()},261:function(e){e.exports=JSON.parse('{"nested":{"protocol":{"nested":{"Error":{"fields":{"code":{"type":"uint32","id":1},"message":{"type":"string","id":2}}},"MethodType":{"values":{"CONNECT":0,"SUBSCRIBE":1,"UNSUBSCRIBE":2,"PUBLISH":3,"PRESENCE":4,"PRESENCE_STATS":5,"HISTORY":6,"PING":7,"SEND":8,"RPC":9,"REFRESH":10,"SUB_REFRESH":11}},"Command":{"fields":{"id":{"type":"uint32","id":1},"method":{"type":"MethodType","id":2},"params":{"type":"bytes","id":3}}},"Reply":{"fields":{"id":{"type":"uint32","id":1},"error":{"type":"Error","id":2},"result":{"type":"bytes","id":3}}},"PushType":{"values":{"PUBLICATION":0,"JOIN":1,"LEAVE":2,"UNSUB":3,"MESSAGE":4,"SUB":5}},"Push":{"fields":{"type":{"type":"PushType","id":1},"channel":{"type":"string","id":2},"data":{"type":"bytes","id":3}}},"ClientInfo":{"fields":{"user":{"type":"string","id":1},"client":{"type":"string","id":2},"conn_info":{"type":"bytes","id":3},"chan_info":{"type":"bytes","id":4}}},"Publication":{"fields":{"seq":{"type":"uint32","id":1},"gen":{"type":"uint32","id":2},"uid":{"type":"string","id":3},"data":{"type":"bytes","id":4},"info":{"type":"ClientInfo","id":5},"offset":{"type":"uint64","id":6}}},"Join":{"fields":{"info":{"type":"ClientInfo","id":1}}},"Leave":{"fields":{"info":{"type":"ClientInfo","id":1}}},"Unsub":{"fields":{"resubscribe":{"type":"bool","id":1}}},"Sub":{"fields":{"recoverable":{"type":"bool","id":1},"seq":{"type":"uint32","id":2},"gen":{"type":"uint32","id":3},"epoch":{"type":"string","id":4},"offset":{"type":"uint64","id":5},"positioned":{"type":"bool","id":6}}},"Message":{"fields":{"data":{"type":"bytes","id":1}}},"ConnectRequest":{"fields":{"token":{"type":"string","id":1},"data":{"type":"bytes","id":2},"subs":{"keyType":"string","type":"SubscribeRequest","id":3},"name":{"type":"string","id":4},"version":{"type":"string","id":5}}},"ConnectResult":{"fields":{"client":{"type":"string","id":1},"version":{"type":"string","id":2},"expires":{"type":"bool","id":3},"ttl":{"type":"uint32","id":4},"data":{"type":"bytes","id":5},"subs":{"keyType":"string","type":"SubscribeResult","id":6}}},"RefreshRequest":{"fields":{"token":{"type":"string","id":1}}},"RefreshResult":{"fields":{"client":{"type":"string","id":1},"version":{"type":"string","id":2},"expires":{"type":"bool","id":3},"ttl":{"type":"uint32","id":4}}},"SubscribeRequest":{"fields":{"channel":{"type":"string","id":1},"token":{"type":"string","id":2},"recover":{"type":"bool","id":3},"seq":{"type":"uint32","id":4},"gen":{"type":"uint32","id":5},"epoch":{"type":"string","id":6},"offset":{"type":"uint64","id":7}}},"SubscribeResult":{"fields":{"expires":{"type":"bool","id":1},"ttl":{"type":"uint32","id":2},"recoverable":{"type":"bool","id":3},"seq":{"type":"uint32","id":4},"gen":{"type":"uint32","id":5},"epoch":{"type":"string","id":6},"publications":{"rule":"repeated","type":"Publication","id":7},"recovered":{"type":"bool","id":8},"offset":{"type":"uint64","id":9},"positioned":{"type":"bool","id":10}}},"SubRefreshRequest":{"fields":{"channel":{"type":"string","id":1},"token":{"type":"string","id":2}}},"SubRefreshResult":{"fields":{"expires":{"type":"bool","id":1},"ttl":{"type":"uint32","id":2}}},"UnsubscribeRequest":{"fields":{"channel":{"type":"string","id":1}}},"UnsubscribeResult":{"fields":{}},"PublishRequest":{"fields":{"channel":{"type":"string","id":1},"data":{"type":"bytes","id":2}}},"PublishResult":{"fields":{}},"PresenceRequest":{"fields":{"channel":{"type":"string","id":1}}},"PresenceResult":{"fields":{"presence":{"keyType":"string","type":"ClientInfo","id":1}}},"PresenceStatsRequest":{"fields":{"channel":{"type":"string","id":1}}},"PresenceStatsResult":{"fields":{"num_clients":{"type":"uint32","id":1},"num_users":{"type":"uint32","id":2}}},"HistoryRequest":{"fields":{"channel":{"type":"string","id":1},"use_since":{"type":"bool","id":2},"offset":{"type":"uint64","id":3},"epoch":{"type":"string","id":4},"use_limit":{"type":"bool","id":5},"limit":{"type":"int32","id":6}}},"HistoryResult":{"fields":{"publications":{"rule":"repeated","type":"Publication","id":1},"epoch":{"type":"string","id":2},"offset":{"type":"uint64","id":3}}},"PingRequest":{"fields":{}},"PingResult":{"fields":{}},"RPCRequest":{"fields":{"data":{"type":"bytes","id":1},"method":{"type":"string","id":2}}},"RPCResult":{"fields":{"data":{"type":"bytes","id":1}}},"SendRequest":{"fields":{"data":{"type":"bytes","id":1}}}}}}}')},545:function(e,t,s){s.r(t),s.d(t,{default:function(){return j}});var r=s(187),i=s.n(r);function n(e,t){return 0===e.lastIndexOf(t,0)}function o(e){return null!=e&&"function"==typeof e}function a(e,t){if(s.g.console){const r=s.g.console[e];o(r)&&r.apply(s.g.console,t)}}class h extends(i()){constructor(e,t,s){super(),this.channel=t,this._centrifuge=e,this._status=0,this._error=null,this._isResubscribe=!1,this._ready=!1,this._subscriptionPromise=null,this._noResubscribe=!1,this._recoverable=!1,this._recover=!1,this._setEvents(s),this._initializePromise(),this._promises={},this._promiseId=0,this.on("error",(function(e){this._centrifuge._debug("subscription error",e)}))}_nextPromiseId(){return++this._promiseId}_initializePromise(){this._ready=!1,this._subscriptionPromise=new Promise(((e,t)=>{this._resolve=t=>{this._ready=!0,e(t)},this._reject=e=>{this._ready=!0,t(e)}})).then((function(){}),(function(){}))}_needRecover(){return!0===this._recoverable&&!0===this._recover}_setEvents(e){if(e)if(o(e))this.on("publish",e);else if(Object.prototype.toString.call(e)===Object.prototype.toString.call({})){const t=["publish","join","leave","unsubscribe","subscribe","error"];for(let s=0,r=t.length;s<r;s++){const r=t[s];r in e&&this.on(r,e[r])}}}_isNew(){return 0===this._status}_isUnsubscribed(){return 4===this._status}_isSubscribing(){return 1===this._status}_isReady(){return 2===this._status||3===this._status}_isSuccess(){return 2===this._status}_isError(){return 3===this._status}_setNew(){this._status=0}_setSubscribing(e){this._isResubscribe=e||!1,!0===this._ready&&this._initializePromise(),this._status=1}_setSubscribeSuccess(e){if(2===this._status)return;this._status=2;const t=this._getSubscribeSuccessContext(e);this._recover=!1,this.emit("subscribe",t),this._resolve(t);for(const e in this._promises)clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e]}_setSubscribeError(e){if(3===this._status)return;this._status=3,this._error=e;const t=this._getSubscribeErrorContext();this.emit("error",t),this._reject(t);for(const t in this._promises)clearTimeout(this._promises[t].timeout),this._promises[t].reject(e),delete this._promises[t]}_triggerUnsubscribe(){this.emit("unsubscribe",{channel:this.channel})}_setUnsubscribed(e){if(this._centrifuge._clearSubRefreshTimeout(this.channel),4===this._status)return;const t=2===this._status;this._status=4,!0===e&&(this._recover=!1,this._noResubscribe=!0,delete this._centrifuge._lastSeq[this.channel],delete this._centrifuge._lastGen[this.channel],delete this._centrifuge._lastEpoch[this.channel]),t&&this._triggerUnsubscribe()}_shouldResubscribe(){return!this._noResubscribe}_getSubscribeSuccessContext(e){let t={channel:this.channel,isResubscribe:this._isResubscribe};return e&&(t=this._centrifuge._expandSubscribeContext(t,e)),t}_getSubscribeErrorContext(){const e=this._error;return e.channel=this.channel,e.isResubscribe=this._isResubscribe,e}ready(e,t){this._ready&&(this._isSuccess()?e(this._getSubscribeSuccessContext()):t(this._getSubscribeErrorContext()))}subscribe(){2!==this._status&&(this._noResubscribe=!1,this._centrifuge._subscribe(this))}unsubscribe(){this._setUnsubscribed(!0),this._centrifuge._unsubscribe(this)}_methodCall(e,t){return new Promise(((s,r)=>{let i;i=this._isSuccess()?Promise.resolve():this._isError()?Promise.reject(this._error):new Promise(((e,t)=>{const s=setTimeout((function(){t({code:0,message:"timeout"})}),this._centrifuge._config.timeout);this._promises[this._nextPromiseId()]={timeout:s,resolve:e,reject:t}})),i.then((()=>this._centrifuge._call(e).then((e=>{s(this._centrifuge._decoder.decodeCommandResult(t,e.result)),e.next&&e.next()}),(e=>{r(e.error),e.next&&e.next()}))),(e=>{r(e)}))}))}publish(e){return this._methodCall({method:this._centrifuge._methodType.PUBLISH,params:{channel:this.channel,data:e}},this._centrifuge._methodType.PUBLISH)}presence(){return this._methodCall({method:this._centrifuge._methodType.PRESENCE,params:{channel:this.channel}},this._centrifuge._methodType.PRESENCE)}presenceStats(){return this._methodCall({method:this._centrifuge._methodType.PRESENCE_STATS,params:{channel:this.channel}},this._centrifuge._methodType.PRESENCE_STATS)}history(e){const t=this._centrifuge._getHistoryParams(this.channel,e);return this._methodCall({method:this._centrifuge._methodType.HISTORY,params:t},this._centrifuge._methodType.HISTORY)}}const u={CONNECT:0,SUBSCRIBE:1,UNSUBSCRIBE:2,PUBLISH:3,PRESENCE:4,PRESENCE_STATS:5,HISTORY:6,PING:7,SEND:8,RPC:9,REFRESH:10,SUB_REFRESH:11},c={PUBLICATION:0,JOIN:1,LEAVE:2,UNSUB:3,MESSAGE:4,SUB:5};class l{encodeCommands(e){const t=[];for(const s in e)e.hasOwnProperty(s)&&t.push(JSON.stringify(e[s]));return t.join("\n")}}class f{decodeReplies(e){const t=[],s=e.split("\n");for(const e in s)if(s.hasOwnProperty(e)){if(!s[e])continue;const r=JSON.parse(s[e]);t.push(r)}return t}decodeCommandResult(e,t){return t}decodePush(e){return e}decodePushData(e,t){return t}}const p="timeout",d="connection closed";class y extends(i()){constructor(e,t){super(),this._url=e,this._websocket=null,this._sockjs=null,this._isSockjs=!1,this._binary=!1,this._methodType=null,this._pushType=null,this._encoder=null,this._decoder=null,this._status="disconnecte",this._reconnect=!0,this._reconnecting=!1,this._transport=null,this._transportName=null,this._transportClosed=!0,this._messageId=0,this._clientID=null,this._refreshRequired=!1,this._subs={},this._serverSubs={},this._lastSeq={},this._lastGen={},this._lastOffset={},this._lastEpoch={},this._messages=[],this._isBatching=!1,this._isSubscribeBatching=!1,this._privateChannels={},this._numRefreshFailed=0,this._refreshTimeout=null,this._pingTimeout=null,this._pongTimeout=null,this._subRefreshTimeouts={},this._retries=0,this._callbacks={},this._latency=null,this._latencyStart=null,this._connectData=null,this._token=null,this._xhrID=0,this._xhrs={},this._dispatchPromise=Promise.resolve(),this._config={debug:!1,name:"",version:"",websocket:null,sockjs:null,minRetry:1e3,maxRetry:2e4,timeout:5e3,ping:!0,pingInterval:25e3,pongWaitTimeout:5e3,privateChannelPrefix:"$",onTransportClose:null,sockjsServer:null,sockjsTransports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh",refreshHeaders:{},refreshParams:{},refreshData:{},refreshAttempts:null,refreshInterval:1e3,onRefreshFailed:null,onRefresh:null,subscribeEndpoint:"/centrifuge/subscribe",subscribeHeaders:{},subscribeParams:{},subRefreshInterval:1e3,onPrivateSubscribe:null},this._configure(t)}setToken(e){this._token=e}setConnectData(e){this._connectData=e}setRefreshHeaders(e){this._config.refreshHeaders=e}setRefreshParams(e){this._config.refreshParams=e}setRefreshData(e){this._config.refreshData=e}setSubscribeHeaders(e){this._config.subscribeHeaders=e}setSubscribeParams(e){this._config.subscribeParams=e}_ajax(e,t,r,i,n){let o="";this._debug("sending AJAX request to",e,"with data",JSON.stringify(i));const a=s.g.XMLHttpRequest?new s.g.XMLHttpRequest:new s.g.ActiveXObject("Microsoft.XMLHTTP");for(const e in t)t.hasOwnProperty(e)&&(o.length>0&&(o+="&"),o+=encodeURIComponent(e)+"="+encodeURIComponent(t[e]));o.length>0&&(o="?"+o),a.open("POST",e+o,!0),"withCredentials"in a&&(a.withCredentials=!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/json");for(const e in r)r.hasOwnProperty(e)&&a.setRequestHeader(e,r[e]);return a.onreadystatechange=()=>{if(4===a.readyState)if(200===a.status){let e,t=!1;try{e=JSON.parse(a.responseText),t=!0}catch(e){n({error:"Invalid JSON. Data was: "+a.responseText,status:200,data:null})}t&&n({data:e,status:200})}else this._log("wrong status code in AJAX response",a.status),n({status:a.status,data:null})},setTimeout((()=>a.send(JSON.stringify(i))),20),a}_log(){a("info",arguments)}_debug(){!0===this._config.debug&&a("debug",arguments)}_websocketSupported(){return null!==this._config.websocket||!("function"!=typeof WebSocket&&"object"!=typeof WebSocket)}_setFormat(e){if(!this._formatOverride(e)){if("protobuf"===e)throw new Error("not implemented by JSON only Centrifuge client – use client with Protobuf");this._binary=!1,this._methodType=u,this._pushType=c,this._encoder=new l,this._decoder=new f}}_formatOverride(e){return!1}_configure(e){if(!("Promise"in s.g))throw new Error("Promise polyfill required");if(function(e,t){for(const s in t)t.hasOwnProperty(s)&&(e[s]=t[s])}(this._config,e||{}),this._debug("centrifuge config",this._config),!this._url)throw new Error("url required");if(n(this._url,"ws")&&this._url.indexOf("format=protobuf")>-1?this._setFormat("protobuf"):this._setFormat("json"),n(this._url,"http"))if(this._debug("client will try to connect to SockJS endpoint"),null!==this._config.sockjs)this._debug("SockJS explicitly provided in options"),this._sockjs=this._config.sockjs;else{if(void 0===s.g.SockJS)throw new Error("SockJS not found, use ws:// in url or include SockJS");this._debug("use globally defined SockJS"),this._sockjs=s.g.SockJS}else this._debug("client will connect to websocket endpoint")}_setStatus(e){this._status!==e&&(this._debug("Status",this._status,"->",e),this._status=e)}_isDisconnected(){return"disconnected"===this._status}_isConnecting(){return"connecting"===this._status}_isConnected(){return"connected"===this._status}_nextMessageId(){return++this._messageId}_resetRetry(){this._debug("reset retries count to 0"),this._retries=0}_getRetryInterval(){const e=function(e,t,s){const r=.5*Math.random(),i=Math.min(s,t*Math.pow(2,e+1));return Math.floor((1-r)*i)}(this._retries,this._config.minRetry,this._config.maxRetry);return this._retries+=1,e}_abortInflightXHRs(){for(const e in this._xhrs){try{this._xhrs[e].abort()}catch(e){this._debug("error aborting xhr",e)}delete this._xhrs[e]}}_clearConnectedState(e){this._clientID=null,this._stopPing();for(const e in this._callbacks)if(this._callbacks.hasOwnProperty(e)){const t=this._callbacks[e];clearTimeout(t.timeout);const s=t.errback;if(!s)continue;s({error:this._createErrorObject("disconnected")})}this._callbacks={};for(const t in this._subs)if(this._subs.hasOwnProperty(t)){const s=this._subs[t];e?(s._isSuccess()&&(s._triggerUnsubscribe(),s._recover=!0),s._shouldResubscribe()&&s._setSubscribing()):s._setUnsubscribed()}this._abortInflightXHRs(),null!==this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);for(const e in this._subRefreshTimeouts)this._subRefreshTimeouts.hasOwnProperty(e)&&this._subRefreshTimeouts[e]&&this._clearSubRefreshTimeout(e);this._subRefreshTimeouts={},this._reconnect||(this._subs={})}_isTransportOpen(){return this._isSockjs?this._transport&&this._transport.transport&&this._transport.transport.readyState===this._transport.transport.OPEN:this._transport&&this._transport.readyState===this._transport.OPEN}_transportSend(e){if(!e.length)return!0;if(!this._isTransportOpen()){for(let t in e){let e=t.id;if(!(e in this._callbacks))continue;const s=this._callbacks[e];clearTimeout(this._callbacks[e].timeout),delete this._callbacks[e],(0,s.errback)({error:this._createErrorObject(d,0)})}return!1}return this._transport.send(this._encoder.encodeCommands(e)),!0}_setupTransport(){if(this._isSockjs=!1,null!==this._sockjs){const e={transports:this._config.sockjsTransports};null!==this._config.sockjsServer&&(e.server=this._config.sockjsServer),this._isSockjs=!0,this._transport=new this._sockjs(this._url,null,e)}else{if(!this._websocketSupported())return void this._debug("No Websocket support and no SockJS configured, can not connect");null!==this._config.websocket?this._websocket=this._config.websocket:this._websocket=WebSocket,this._transport=new this._websocket(this._url),!0===this._binary&&(this._transport.binaryType="arraybuffer")}this._transport.onopen=()=>{this._transportClosed=!1,this._isSockjs?(this._transportName="sockjs-"+this._transport.transport,this._transport.onheartbeat=()=>this._restartPing()):this._transportName="websocket";const e={};(this._token||this._connectData||this._config.name||this._config.version)&&(e.params={}),this._token&&(e.params.token=this._token),this._connectData&&(e.params.data=this._connectData),this._config.name&&(e.params.name=this._config.name),this._config.version&&(e.params.version=this._config.version);let t={},s=!1;for(const e in this._serverSubs)if(this._serverSubs.hasOwnProperty(e)&&this._serverSubs[e].recoverable){s=!0;let r={recover:!0};this._serverSubs[e].seq||this._serverSubs[e].gen?(this._serverSubs[e].seq&&(r.seq=this._serverSubs[e].seq),this._serverSubs[e].gen&&(r.gen=this._serverSubs[e].gen)):this._serverSubs[e].offset&&(r.offset=this._serverSubs[e].offset),this._serverSubs[e].epoch&&(r.epoch=this._serverSubs[e].epoch),t[e]=r}s&&(e.params||(e.params={}),e.params.subs=t),this._latencyStart=new Date,this._call(e).then((e=>{this._connectResponse(this._decoder.decodeCommandResult(this._methodType.CONNECT,e.result),s),e.next&&e.next()}),(e=>{109===e.error.code&&(this._refreshRequired=!0),this._disconnect("connect error",!0),e.next&&e.next()}))},this._transport.onerror=e=>{this._debug("transport level error",e)},this._transport.onclose=e=>{this._transportClosed=!0;let t=d,s=!0;if(e&&"reason"in e&&e.reason)try{const r=JSON.parse(e.reason);this._debug("reason is an advice object",r),t=r.reason,s=r.reconnect}catch(s){t=e.reason,this._debug("reason is a plain string",t)}if(null!==this._config.onTransportClose&&this._config.onTransportClose({event:e,reason:t,reconnect:s}),this._disconnect(t,s),!0===this._reconnect){this._reconnecting=!0;const e=this._getRetryInterval();this._debug("reconnect after "+e+" milliseconds"),setTimeout((()=>{!0===this._reconnect&&(this._refreshRequired?this._refresh():this._connect())}),e)}},this._transport.onmessage=e=>{this._dataReceived(e.data)}}rpc(e){return this._rpc("",e)}namedRPC(e,t){return this._rpc(e,t)}_rpc(e,t){let s={data:t};""!==e&&(s.method=e);const r={method:this._methodType.RPC,params:s};return this._methodCall(r,(function(e){return e}))}send(e){const t={method:this._methodType.SEND,params:{data:e}};return this.isConnected()&&this._transportSend([t])?Promise.resolve({}):Promise.reject(this._createErrorObject(d,0))}_getHistoryParams(e,t){let s={channel:e};return void 0!==t&&(t.since&&(s.use_since=!0,t.since.offset&&(s.offset=t.since.offset),t.since.epoch&&(s.epoch=t.since.epoch)),void 0!==t.limit&&(s.use_limit=!0,s.limit=t.limit)),s}_methodCall(e,t){return this.isConnected()?new Promise(((s,r)=>{this._call(e).then((r=>{s(t(this._decoder.decodeCommandResult(e.method,r.result))),r.next&&r.next()}),(e=>{r(e.error),e.next&&e.next()}))})):Promise.reject(this._createErrorObject(d,0))}publish(e,t){const s={method:this._methodType.PUBLISH,params:{channel:e,data:t}};return this._methodCall(s,(function(e){return{}}))}history(e,t){const s=this._getHistoryParams(e,t),r={method:this._methodType.HISTORY,params:s};return this._methodCall(r,(function(e){return e}))}presence(e){const t={method:this._methodType.PRESENCE,params:{channel:e}};return this._methodCall(t,(function(e){return e}))}presenceStats(e){const t={method:this._methodType.PRESENCE_STATS,params:{channel:e}};return this._methodCall(t,(function(e){return e}))}_dataReceived(e){const t=this._decoder.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then((()=>{let e;this._dispatchPromise=new Promise((t=>{e=t})),this._dispatchSynchronized(t,e)})),this._restartPing()}_dispatchSynchronized(e,t){let s=Promise.resolve();for(const t in e)e.hasOwnProperty(t)&&(s=s.then((()=>this._dispatchReply(e[t]))));s=s.then((()=>{t()}))}_dispatchReply(e){var t;const s=new Promise((e=>{t=e}));if(null==e)return this._debug("dispatch: got undefined or null reply"),t(),s;const r=e.id;return r&&r>0?this._handleReply(e,t):this._handlePush(e.result,t),s}_call(e){return new Promise(((t,s)=>{const r=this._addMessage(e);this._registerCall(r,t,s)}))}_connect(){this.isConnected()?this._debug("connect called when already connected"):"connecting"!==this._status&&(this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,this._setupTransport())}_disconnect(e,t){const s=t||!1;if(!1===s&&(this._reconnect=!1),this._isDisconnected())s||this._clearConnectedState(s);else{if(this._clearConnectedState(s),this._debug("disconnected:",e,t),this._setStatus("disconnected"),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),!1===this._reconnecting){for(const e in this._serverSubs)this._serverSubs.hasOwnProperty(e)&&this.emit("unsubscribe",{channel:e});this.emit("disconnect",{reason:e,reconnect:s})}!1===s&&(this._subs={},this._serverSubs={}),this._transportClosed||this._transport.close()}}_refreshFailed(){this._numRefreshFailed=0,this._isDisconnected()||this._disconnect("refresh failed",!1),null!==this._config.onRefreshFailed&&this._config.onRefreshFailed()}_refresh(){if(this._debug("refresh token"),0===this._config.refreshAttempts)return this._debug("refresh attempts set to 0, do not send refresh request at all"),void this._refreshFailed();null!==this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);const e=this._clientID,t=this._newXHRID(),s=s=>{if(t in this._xhrs&&delete this._xhrs[t],this._clientID===e)if(s.error||200!==s.status){if(s.error?this._debug("error refreshing connection token",s.error):this._debug("error refreshing connection token: wrong status code",s.status),this._numRefreshFailed++,null!==this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),null!==this._config.refreshAttempts&&this._numRefreshFailed>=this._config.refreshAttempts)return void this._refreshFailed();const e=Math.round(1e3*Math.random()*Math.max(this._numRefreshFailed,20)),t=this._config.refreshInterval+e;this._refreshTimeout=setTimeout((()=>this._refresh()),t)}else if(this._numRefreshFailed=0,this._token=s.data.token,this._token)if(this._isDisconnected()&&this._reconnect)this._debug("token refreshed, connect from scratch"),this._connect();else{this._debug("send refreshed token");const e={method:this._methodType.REFRESH,params:{token:this._token}};this._call(e).then((e=>{this._refreshResponse(this._decoder.decodeCommandResult(this._methodType.REFRESH,e.result)),e.next&&e.next()}),(e=>{this._refreshError(e.error),e.next&&e.next()}))}else this._refreshFailed()};if(null!==this._config.onRefresh){const e={};this._config.onRefresh(e,s)}else{const e=this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,s);this._xhrs[t]=e}}_refreshError(e){this._debug("refresh error",e),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);const t=this._config.refreshInterval+Math.round(1e3*Math.random());this._refreshTimeout=setTimeout((()=>this._refresh()),t)}_refreshResponse(e){this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._clientID=e.client,this._refreshTimeout=setTimeout((()=>this._refresh()),this._getTTLMilliseconds(e.ttl)))}_newXHRID(){return this._xhrID++,this._xhrID}_subRefresh(e){if(this._debug("refresh subscription token for channel",e),void 0===this._subRefreshTimeouts[e])return;this._clearSubRefreshTimeout(e);const t=this._clientID,s=this._newXHRID(),r=r=>{if(s in this._xhrs&&delete this._xhrs[s],r.error||200!==r.status||this._clientID!==t)return;let i={};if(r.data.channels)for(const e in r.data.channels){const t=r.data.channels[e];t.channel&&(i[t.channel]=t.token)}const n=i[e];if(!n)return;const o={method:this._methodType.SUB_REFRESH,params:{channel:e,token:n}};null!==this._getSub(e)&&this._call(o).then((t=>{this._subRefreshResponse(e,this._decoder.decodeCommandResult(this._methodType.SUB_REFRESH,t.result)),t.next&&t.next()}),(t=>{this._subRefreshError(e,t.error),t.next&&t.next()}))},i={client:this._clientID,channels:[e]};if(null!==this._config.onPrivateSubscribe)this._config.onPrivateSubscribe({data:i},r);else{const e=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,i,r);this._xhrs[s]=e}}_clearSubRefreshTimeout(e){void 0!==this._subRefreshTimeouts[e]&&(clearTimeout(this._subRefreshTimeouts[e]),delete this._subRefreshTimeouts[e])}_subRefreshError(e,t){if(this._debug("subscription refresh error",e,t),this._clearSubRefreshTimeout(e),null===this._getSub(e))return;const s=Math.round(1e3*Math.random());let r=setTimeout((()=>this._subRefresh(e)),this._config.subRefreshInterval+s);this._subRefreshTimeouts[e]=r}_subRefreshResponse(e,t){if(this._debug("subscription refresh success",e),this._clearSubRefreshTimeout(e),null!==this._getSub(e)&&!0===t.expires){let s=setTimeout((()=>this._subRefresh(e)),this._getTTLMilliseconds(t.ttl));this._subRefreshTimeouts[e]=s}}_subscribe(e,t){this._debug("subscribing on",e.channel);const s=e.channel;if(s in this._subs||(this._subs[s]=e),!this.isConnected())return void e._setNew();e._setSubscribing(t);const r={method:this._methodType.SUBSCRIBE,params:{channel:s}};if(n(s,this._config.privateChannelPrefix))this._isSubscribeBatching?this._privateChannels[s]=!0:(this.startSubscribeBatching(),this._subscribe(e),this.stopSubscribeBatching());else{const t=e._needRecover();if(!0===t){r.params.recover=!0;const e=this._getLastSeq(s),t=this._getLastGen(s);if(e||t)e&&(r.params.seq=e),t&&(r.params.gen=t);else{const e=this._getLastOffset(s);e&&(r.params.offset=e)}const i=this._getLastEpoch(s);i&&(r.params.epoch=i)}this._call(r).then((e=>{this._subscribeResponse(s,t,this._decoder.decodeCommandResult(this._methodType.SUBSCRIBE,e.result)),e.next&&e.next()}),(e=>{this._subscribeError(s,e.error),e.next&&e.next()}))}}_unsubscribe(e){delete this._subs[e.channel],delete this._lastOffset[e.channel],delete this._lastSeq[e.channel],delete this._lastGen[e.channel],this.isConnected()&&this._addMessage({method:this._methodType.UNSUBSCRIBE,params:{channel:e.channel}})}_getTTLMilliseconds(e){return Math.min(1e3*e,2147483647)}getSub(e){return this._getSub(e)}_getSub(e){return this._subs[e]||null}_isServerSub(e){return void 0!==this._serverSubs[e]}_connectResponse(e,t){const s=this._reconnecting;if(this._reconnecting=!1,this._resetRetry(),this._refreshRequired=!1,this.isConnected())return;null!==this._latencyStart&&(this._latency=(new Date).getTime()-this._latencyStart.getTime(),this._latencyStart=null),this._clientID=e.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout((()=>this._refresh()),this._getTTLMilliseconds(e.ttl))),this.startBatching(),this.startSubscribeBatching();for(const e in this._subs)if(this._subs.hasOwnProperty(e)){const t=this._subs[e];t._shouldResubscribe()&&this._subscribe(t,s)}this.stopSubscribeBatching(),this.stopBatching(),this._startPing();const r={client:e.client,transport:this._transportName,latency:this._latency};e.data&&(r.data=e.data),this.emit("connect",r),e.subs&&this._processServerSubs(e.subs)}_processServerSubs(e){for(const t in e)if(e.hasOwnProperty(t)){const s=e[t];let r={channel:t,isResubscribe:void 0!==this._serverSubs[t]};r=this._expandSubscribeContext(r,s),this.emit("subscribe",r)}for(const t in e)if(e.hasOwnProperty(t)){const s=e[t];if(s.recovered){let e=s.publications;if(e&&e.length>0){e.length>1&&(!e[0].offset||e[0].offset>e[1].offset)&&(e=e.reverse());for(let s in e)e.hasOwnProperty(s)&&this._handlePublication(t,e[s])}}this._serverSubs[t]={seq:s.seq,gen:s.gen,offset:s.offset,epoch:s.epoch,recoverable:s.recoverable}}}_stopPing(){null!==this._pongTimeout&&(clearTimeout(this._pongTimeout),this._pongTimeout=null),null!==this._pingTimeout&&(clearTimeout(this._pingTimeout),this._pingTimeout=null)}_startPing(){!0!==this._config.ping||this._config.pingInterval<=0||this.isConnected()&&(this._pingTimeout=setTimeout((()=>{this.isConnected()?(this.ping(),this._pongTimeout=setTimeout((()=>{this._disconnect("no ping",!0)}),this._config.pongWaitTimeout)):this._stopPing()}),this._config.pingInterval))}_restartPing(){this._stopPing(),this._startPing()}_subscribeError(e,t){const s=this._getSub(e);s&&s._isSubscribing()&&(0!==t.code||t.message!==p?s._setSubscribeError(t):this._disconnect("timeout",!0))}_expandSubscribeContext(e,t){let s=!1;"recovered"in t&&(s=t.recovered),e.recovered=s;let r=!1;"positioned"in t&&(r=t.positioned);let i="";"epoch"in t&&(i=t.epoch);let n=0;return"offset"in t&&(n=t.offset),r&&(e.streamPosition={offset:n,epoch:i}),e}_subscribeResponse(e,t,s){const r=this._getSub(e);if(!r)return;if(!r._isSubscribing())return;r._setSubscribeSuccess(s);let i=s.publications;if(i&&i.length>0){i.length>=2&&!i[0].offset&&!i[1].offset&&(i=i.reverse());for(let t in i)i.hasOwnProperty(t)&&this._handlePublication(e,i[t])}if(!s.recoverable||t&&s.recovered||(this._lastSeq[e]=s.seq||0,this._lastGen[e]=s.gen||0,this._lastOffset[e]=s.offset||0),this._lastEpoch[e]=s.epoch||"",s.recoverable&&(r._recoverable=!0),!0===s.expires){let t=setTimeout((()=>this._subRefresh(e)),this._getTTLMilliseconds(s.ttl));this._subRefreshTimeouts[e]=t}}_handleReply(e,t){const s=e.id,r=e.result;if(!(s in this._callbacks))return void t();const i=this._callbacks[s];if(clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],"error"in(n=e)&&null!==n.error){const s=i.errback;if(!s)return void t();s({error:e.error,next:t})}else{const e=i.callback;if(!e)return;e({result:r,next:t})}var n}_handleJoin(e,t){const s={info:t.info},r=this._getSub(e);r?r.emit("join",s):this._isServerSub(e)&&(s.channel=e,this.emit("join",s))}_handleLeave(e,t){const s={info:t.info},r=this._getSub(e);r?r.emit("leave",s):this._isServerSub(e)&&(s.channel=e,this.emit("leave",s))}_handleUnsub(e,t){const s={},r=this._getSub(e);r?(r.unsubscribe(),!0===t.resubscribe&&r.subscribe()):this._isServerSub(e)&&(delete this._serverSubs[e],s.channel=e,this.emit("unsubscribe",s))}_handleSub(e,t){this._serverSubs[e]={seq:t.seq,gen:t.gen,offset:t.offset,epoch:t.epoch,recoverable:t.recoverable};let s={channel:e,isResubscribe:!1};s=this._expandSubscribeContext(s,t),this.emit("subscribe",s)}_handlePublication(e,t){const s=this._getSub(e),r={data:t.data,seq:t.seq,gen:t.gen,offset:t.offset};t.info&&(r.info=t.info),s?(void 0!==t.seq&&(this._lastSeq[e]=t.seq),void 0!==t.gen&&(this._lastGen[e]=t.gen),void 0!==t.offset&&(this._lastOffset[e]=t.offset),s.emit("publish",r)):this._isServerSub(e)&&(void 0!==t.seq&&(this._serverSubs[e].seq=t.seq),void 0!==t.gen&&(this._serverSubs[e].gen=t.gen),void 0!==t.offset&&(this._serverSubs[e].offset=t.offset),r.channel=e,this.emit("publish",r))}_handleMessage(e){this.emit("message",e.data)}_handlePush(e,t){const s=this._decoder.decodePush(e);let r=0;"type"in s&&(r=s.type);const i=s.channel;if(r===this._pushType.PUBLICATION){const e=this._decoder.decodePushData(this._pushType.PUBLICATION,s.data);this._handlePublication(i,e)}else if(r===this._pushType.MESSAGE){const e=this._decoder.decodePushData(this._pushType.MESSAGE,s.data);this._handleMessage(e)}else if(r===this._pushType.JOIN){const e=this._decoder.decodePushData(this._pushType.JOIN,s.data);this._handleJoin(i,e)}else if(r===this._pushType.LEAVE){const e=this._decoder.decodePushData(this._pushType.LEAVE,s.data);this._handleLeave(i,e)}else if(r===this._pushType.UNSUB){const e=this._decoder.decodePushData(this._pushType.UNSUB,s.data);this._handleUnsub(i,e)}else if(r===this._pushType.SUB){const e=this._decoder.decodePushData(this._pushType.SUB,s.data);this._handleSub(i,e)}t()}_flush(){const e=this._messages.slice(0);this._messages=[],this._transportSend(e)}_ping(){const e={method:this._methodType.PING};this._call(e).then((e=>{this._pingResponse(this._decoder.decodeCommandResult(this._methodType.PING,e.result)),e.next&&e.next()}),(e=>{this._debug("ping error",e.error),e.next&&e.next()}))}_pingResponse(e){this.isConnected()&&(this._stopPing(),this._startPing())}_getLastSeq(e){return this._lastSeq[e]||0}_getLastOffset(e){return this._lastOffset[e]||0}_getLastGen(e){return this._lastGen[e]||0}_getLastEpoch(e){return this._lastEpoch[e]||""}_createErrorObject(e,t){return{message:e,code:t||0}}_registerCall(e,t,s){this._callbacks[e]={callback:t,errback:s,timeout:null},this._callbacks[e].timeout=setTimeout((()=>{delete this._callbacks[e],o(s)&&s({error:this._createErrorObject(p)})}),this._config.timeout)}_addMessage(e){let t=this._nextMessageId();return e.id=t,!0===this._isBatching?this._messages.push(e):this._transportSend([e]),t}isConnected(){return this._isConnected()}connect(){this._connect()}disconnect(){this._disconnect("client",!1)}ping(){return this._ping()}startBatching(){this._isBatching=!0}stopBatching(){this._isBatching=!1,this._flush()}startSubscribeBatching(){this._isSubscribeBatching=!0}stopSubscribeBatching(){this._isSubscribeBatching=!1;const e=this._privateChannels;this._privateChannels={};const t=[];for(const s in e)if(e.hasOwnProperty(s)){if(!this._getSub(s))continue;t.push(s)}if(0===t.length)return void this._debug("no private channels found, no need to make request");const s={client:this._clientID,channels:t},r=this._clientID,i=this._newXHRID(),n=e=>{if(i in this._xhrs&&delete this._xhrs[i],this._clientID!==r)return;if(e.error||200!==e.status){this._debug("authorization request failed");for(const e in t)if(t.hasOwnProperty(e)){const s=t[e];this._subscribeError(s,this._createErrorObject("authorization request failed"))}return}let s={};if(e.data.channels)for(const t in e.data.channels){const r=e.data.channels[t];r.channel&&(s[r.channel]=r.token)}let n=!1;this._isBatching||(this.startBatching(),n=!0);for(const e in t)if(t.hasOwnProperty(e)){const r=t[e],i=s[r];if(!i){this._subscribeError(r,this._createErrorObject("permission denied",103));continue}{const e={method:this._methodType.SUBSCRIBE,params:{channel:r,token:i}},t=this._getSub(r);if(null===t)continue;const s=t._needRecover();if(!0===s){e.params.recover=!0;const t=this._getLastSeq(r),s=this._getLastGen(r);if(t||s)t&&(e.params.seq=t),s&&(e.params.gen=s);else{const t=this._getLastOffset(r);t&&(e.params.offset=t)}const i=this._getLastEpoch(r);i&&(e.params.epoch=i)}this._call(e).then((e=>{this._subscribeResponse(r,s,this._decoder.decodeCommandResult(this._methodType.SUBSCRIBE,e.result)),e.next&&e.next()}),(e=>{this._subscribeError(r,e.error),e.next&&e.next()}))}}n&&this.stopBatching()};if(null!==this._config.onPrivateSubscribe)this._config.onPrivateSubscribe({data:s},n);else{const e=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,s,n);this._xhrs[i]=e}}subscribe(e,t){const s=this._getSub(e);if(null!==s)return s._setEvents(t),s._isUnsubscribed()&&s.subscribe(),s;const r=new h(this,e,t);return this._subs[e]=r,r.subscribe(),r}}const _=s(492),m=_.Root.fromJSON(s(261)),b=m.lookupEnum("MethodType").values,g={CONNECT:b.CONNECT,SUBSCRIBE:b.SUBSCRIBE,UNSUBSCRIBE:b.UNSUBSCRIBE,PUBLISH:b.PUBLISH,PRESENCE:b.PRESENCE,PRESENCE_STATS:b.PRESENCE_STATS,HISTORY:b.HISTORY,PING:b.PING,RPC:b.RPC,SEND:b.SEND,REFRESH:b.REFRESH,SUB_REFRESH:b.SUB_REFRESH},v={CONNECT:[m.lookupType("protocol.ConnectRequest"),m.lookupType("protocol.ConnectResult")],REFRESH:[m.lookupType("protocol.RefreshRequest"),m.lookupType("protocol.RefreshResult")],SUBSCRIBE:[m.lookupType("protocol.SubscribeRequest"),m.lookupType("protocol.SubscribeResult")],SUB_REFRESH:[m.lookupType("protocol.SubRefreshRequest"),m.lookupType("protocol.SubRefreshResult")],UNSUBSCRIBE:[m.lookupType("protocol.UnsubscribeRequest"),m.lookupType("protocol.UnsubscribeResult")],PUBLISH:[m.lookupType("protocol.PublishRequest"),m.lookupType("protocol.PublishResult")],PRESENCE:[m.lookupType("protocol.PresenceRequest"),m.lookupType("protocol.PresenceResult")],PRESENCE_STATS:[m.lookupType("protocol.PresenceStatsRequest"),m.lookupType("protocol.PresenceStatsResult")],HISTORY:[m.lookupType("protocol.HistoryRequest"),m.lookupType("protocol.HistoryResult")],PING:[m.lookupType("protocol.PingRequest"),m.lookupType("protocol.PingResult")],RPC:[m.lookupType("protocol.RPCRequest"),m.lookupType("protocol.RPCResult")],SEND:[m.lookupType("protocol.SendRequest"),null]},S={PUBLICATION:m.lookupEnum("PushType").values.PUBLICATION,JOIN:m.lookupEnum("PushType").values.JOIN,LEAVE:m.lookupEnum("PushType").values.LEAVE,UNSUB:m.lookupEnum("PushType").values.UNSUB,MESSAGE:m.lookupEnum("PushType").values.MESSAGE},T={PUBLICATION:m.lookupType("protocol.Publication"),JOIN:m.lookupType("protocol.Join"),LEAVE:m.lookupType("protocol.Leave"),UNSUB:m.lookupType("protocol.Unsub"),MESSAGE:m.lookupType("protocol.Message"),SUB:m.lookupType("protocol.Sub")},E=m.lookupType("protocol.Push"),w=m.lookupType("protocol.Command"),R=m.lookupType("protocol.Reply");class k{encodeCommands(e){const t=_.Writer.create();for(const s in e)if(e.hasOwnProperty(s)){const r=Object.assign({},e[s]);if(r.params){let e;switch(r.method||(r.method=g.CONNECT),r.method){case g.CONNECT:e=v.CONNECT[0];break;case g.REFRESH:e=v.REFRESH[0];break;case g.SUBSCRIBE:e=v.SUBSCRIBE[0];break;case g.SUB_REFRESH:e=v.SUB_REFRESH[0];break;case g.UNSUBSCRIBE:e=v.UNSUBSCRIBE[0];break;case g.PUBLISH:e=v.PUBLISH[0];break;case g.PRESENCE:e=v.PRESENCE[0];break;case g.PRESENCE_STATS:e=v.PRESENCE_STATS[0];break;case g.HISTORY:e=v.HISTORY[0];break;case g.PING:e=v.PING[0];break;case g.RPC:e=v.RPC[0];break;case g.SEND:e=v.SEND[0]}r.params=e.encode(r.params).finish()}w.encodeDelimited(r,t)}return t.finish()}}class O{decodeReplies(e){const t=[],s=_.Reader.create(new Uint8Array(e));for(;s.pos<s.len;){const e=R.decodeDelimited(s);t.push(e)}return t}decodeCommandResult(e,t){var s;switch(e){case g.CONNECT:s=v.CONNECT[1];break;case g.REFRESH:s=v.REFRESH[1];break;case g.SUBSCRIBE:s=v.SUBSCRIBE[1];break;case g.SUB_REFRESH:s=v.SUB_REFRESH[1];break;case g.UNSUBSCRIBE:s=v.UNSUBSCRIBE[1];break;case g.PUBLISH:s=v.PUBLISH[1];break;case g.PRESENCE:s=v.PRESENCE[1];break;case g.PRESENCE_STATS:s=v.PRESENCE_STATS[1];break;case g.HISTORY:s=v.HISTORY[1];break;case g.PING:s=v.PING[1];break;case g.RPC:s=v.RPC[1]}return this._decode(s,t)}decodePush(e){return this._decode(E,e)}decodePushData(e,t){var s;switch(e){case S.PUBLICATION:s=T.PUBLICATION;break;case S.MESSAGE:s=T.MESSAGE;break;case S.JOIN:s=T.JOIN;break;case S.LEAVE:s=T.LEAVE;break;case S.UNSUB:s=T.UNSUB;break;case S.SUB:s=T.SUB}return this._decode(s,t)}_decode(e,t){let s;try{s=e.decode(t)}catch(e){return null}return s}}var j=class extends y{_formatOverride(e){return"protobuf"===e&&(this._binary=!0,this._methodType=g,this._pushType=S,this._encoder=new k,this._decoder=new O,!0)}}}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__),t.exports}return __webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__(545)}()}));
//# sourceMappingURL=centrifuge.protobuf.min.js.map